/***
Copyright (c) 2013-2016, callstats.io
All rights reserved.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.
***/

/*! callstats.js  version = 3.18.2 2017-03-23 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(b){"use strict";!function(){function c(){function b(){var a=(Math.random()+1).toString(36);return a.substring(2,a.length)}function c(){return window.performance.now?window.performance.now()+window.performance.timing.navigationStart:Date.now()}function d(){var a=c();return a+Ya.currentOffset}function e(){return window.performance.now?window.performance.now():null}function f(){"function"==typeof navigator.getBattery&&navigator.getBattery().then(function(a){qa=a})}function g(){if(qa)return qa.level}function h(){if(qa)return qa.charging}function i(a,b){return a.sort().toString()===b.sort().toString()}function j(a){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.enumerateDevices().then(function(b){pa?i(pa,b)||(pa=b,Ub(a)):(pa=b,Ub(a)),setTimeout(function(){j(a)},Ha)}).catch(function(){setTimeout(function(){j(a)},Ha)})}function k(){Da||window.addEventListener("beforeunload",function(a){var b;for(b in Wa)Wa.hasOwnProperty(b)&&Rb(fb.userLeft,null,b,Wa[b].ucID,null,null,null);return"Are you sure you want to close the call?"})}function l(a,b,c,d,f){var g=cc(c,d),h=null;g&&(h=e(),Rb(fb.mediaPlaybackStartEvent,b,c,a,{ssrc:f,highResTs:h},g,null))}function m(a,b,c,d,f){var g=cc(c,d),h=null;g&&(h=e(),Rb(fb.mediaSuspendedEvent,b,c,a,{ssrc:f,highResTs:h},g,null))}function n(a,b,c,d,e){var f=document.getElementById(c);if(f){var g=Wa[b].ucID;f.oncanplay=function(){l(g,a,b,d,e)},f.onsuspend=function(){m(g,a,b,d,e)}}}function o(a){var b=Ta.codebase,c=!1;if(null===a)c=!1;else if(b===yb.firefox){var d=typeof mozRTCPeerConnection,e=typeof RTCPeerConnection;"undefined"!==d&&a instanceof mozRTCPeerConnection?c=!0:"undefined"!==e&&a instanceof RTCPeerConnection&&(c=!0)}else null!==db&&a instanceof db&&(c=!0),"function"!=typeof a&&b!==yb.edge||(c=!0),void 0!==typeof a.createOffer&&(c=!0);return c}function p(a,b){var c;return a&&(b===yb.chrome?a.googLocalAddress?(c=a.googLocalAddress,c.concat(":",a.googRemoteAddress)):a.selectedCandidatePairId&&(c=a.selectedCandidatePairId):b===yb.firefox&&(c=a.localAddr,c.concat(":",a.remoteAddr))),Yb(c)}function q(){var a;return a=navigator.onLine===!0?"online":"offline"}function r(a,b,c,d){var e=null;c.ssrcMap.hasOwnProperty(a.data.ssrc)&&(c.ssrcMap[a.data.ssrc].mediaType=d,b===yb.chrome&&(a.data.googCodecName?e=a.data.googCodecName:a.data.codec&&(e=a.data.codec)),c.ssrcMap[a.data.ssrc].codec=e,a.data.codecImplementationName&&(c.ssrcMap[a.data.ssrc].codecImplementationName=a.data.codecImplementationName))}function s(a,b){var c=zb.unknown;if(a&&a.data&&void 0!==a.data.mediaType)c=a.data.mediaType;else if(b===yb.chrome)void 0!==a&&(void 0!==a.data.googFrameRateReceived||void 0!==a.data.googFrameRateSent?c=zb.video:void 0!==a.data.audioInputLevel||void 0!==a.data.audioOutputLevel?c=zb.audio:void 0!==a.data.mediaType&&(c=a.data.mediaType));else{if(b!==yb.firefox)return;void 0!==a&&void 0!==a.data.framerateMean&&(c=zb.video)}return c}function t(a,b){var c;return b===yb.chrome?void 0!==a.data.googFrameRateOutput?c=parseInt(a.data.googFrameRateOutput,10):void 0!==a.data.googFrameRateDecoded?c=parseInt(a.data.googFrameRateDecoded,10):void 0!==a.data.googFrameRateReceived?c=parseInt(a.data.googFrameRateReceived,10):void 0!==a.data.googFrameRateSent&&(c=parseInt(a.data.googFrameRateSent,10)):b===yb.firefox&&void 0!==a.data.framerateMean&&(c=parseInt(a.data.framerateMean,10)),void 0!==c&&(c=isNaN(c)||c<0?null:c),c}function u(a,b){var c,d,e,f="unavailable";return c=t(a,b),e=v(a,b),d=w(a,b),void 0!==c&&void 0!==e&&void 0!==d&&e>0&&d>0&&(f=e.concat("x",d,"@",c)),f}function v(a,b){var c;return b===yb.chrome?void 0!==a.data.googFrameWidthReceived?c=a.data.googFrameWidthReceived:void 0!==a.data.googFrameWidthSent?c=a.data.googFrameWidthSent:void 0!==a.data.frameWidth&&(c=a.data.frameWidth):b===yb.firefox,c}function w(a,b){var c;return b===yb.chrome?void 0!==a.data.googFrameHeightReceived?c=a.data.googFrameHeightReceived:void 0!==a.data.googFrameHeightSent?c=a.data.googFrameHeightSent:void 0!==a.data.frameHeight&&(c=a.data.frameHeight):b===yb.firefox,c}function x(a){var b;return b=isNaN(a)||a<0?null:a}function y(a,b){var c;if(b===yb.chrome){if(void 0!==a){if(void 0!==a.data.googRtt)return c=x(parseInt(a.data.googRtt,10));if(void 0!==a.data.roundTripTime)return c=x(parseInt(1e3*a.data.roundTripTime,10))}}else if(b===yb.firefox){if(void 0!==a&&void 0!==a.data.mozRtt)return c=x(parseInt(a.data.mozRtt,10))}else if(b===yb.edge&&a&&a.data.roundTripTime)return c=x(parseInt(a.data.roundTripTime,10))}function z(a){var b=isNaN(a)?null:a;return b}function A(a,b){var c;if(b===yb.chrome){if(void 0!==a){if(void 0!==a.data.googJitterReceived)return c=z(parseInt(a.data.googJitterReceived,10)),c&&(c/=1e3),c;if(void 0!==a.data.jitter)return c=z(parseInt(a.data.jitter,10)),c&&(c/=1e3),c}}else if(b===yb.firefox&&void 0!==a&&void 0!==a.data.jitter)return c=z(parseInt(a.data.jitter,10))}function B(a,b){if(b.sort(),b.length>0){var c=a/100*b.length;c=Math.ceil(c);var d=b[c-1];return d}}function C(a){var b,c;return a&&a.length>0&&(b=a.reduce(function(a,b){return a+b}),c=b/a.length),c}function D(a,b,c){var d;return b===zb.audio?a<c.audio.gThreshold?d=ob.excellent:a>c.audio.gThreshold&&a<c.audio.rThreshold?d=ob.fair:a>c.audio.rThreshold&&(d=ob.bad):b===zb.video&&(a<c.video.gThreshold?d=ob.excellent:a>c.video.gThreshold&&a<c.video.rThreshold?d=ob.fair:a>c.video.rThreshold&&(d=ob.bad)),d}function E(a,b,c){var d;return b===zb.audio?a>c.audio.gThreshold?d=ob.excellent:a>c.audio.rThreshold&&a<c.audio.gThreshold?d=ob.fair:a<c.audio.rThreshold&&(d=ob.bad):b===zb.video&&(a>c.video.gThreshold?d=ob.excellent:a>c.video.rThreshold&&a<c.video.gThreshold?d=ob.fair:a<c.video.rThreshold&&(d=ob.bad)),d}function F(){var a,b,c=0,d=0;for(a=0;a<arguments.length;a++)void 0!==arguments[a]&&null!==arguments[a]&&(c+=arguments[a],d++);return d>0&&(c/=d,c=Math.floor(c),c===ob.excellent?b=pb.excellent:c===ob.fair?b=pb.fair:c===ob.bad&&(b=pb.bad)),b}function G(a,b,c){var d,e,f,g,h,i,j,k,l=[];if(void 0!==a.lastStatsSent&&void 0!==a.lastStatsSent.statistics.Transport)for(f=a.lastStatsSent.statistics.Transport,g=a.latestEventSent,h=void 0,d=0;d<b.length;d++){for(h=void 0,e=0;e<f.length;e++)if(b[d].hash===f[e].hash){h=f[e];break}void 0!==h&&(i=parseInt(h.bytesReceived,10),j=parseInt(h.bytesSent,10),k=c-g,k>0&&(b[d].csioReceivedBwKbps=8*(parseInt(b[d].bytesReceived,10)-i)/k,b[d].csioSentBwKbps=8*(parseInt(b[d].bytesSent,10)-j)/k,b[d].csioIntBytesReceived=parseInt(b[d].bytesReceived,10)-i,b[d].csioIntBytesSent=parseInt(b[d].bytesSent,10)-j,void 0!==h.packetsSent&&void 0!==b[d].packetsSent&&(b[d].csioSentPacketRate=(parseInt(b[d].packetsSent,10)-parseInt(h.packetsSent,10))/(k/1e3),b[d].csioIntPacketsSent=parseInt(b[d].packetsSent,10)-parseInt(h.packetsSent,10)),void 0!==h.packetsReceived&&void 0!==b[d].packetsReceived&&(b[d].csioReceivedPacketRate=(parseInt(b[d].packetsReceived,10)-parseInt(h.packetsReceived,10))/(k/1e3),b[d].csioIntPacketsReceived=parseInt(b[d].packetsReceived,10)-parseInt(h.packetsReceived,10))),l.push(b[d]))}return l}function H(a,b,c,d){var e=[];return c===yb.firefox?e=null:c===yb.chrome&&(e=G(a,b,d)),e}function I(a){if(a=z(a),null!==a){var b=a<0?null:a;return b}}function J(a,b,c,d,e,f,g){return void 0===a[c]&&(a[c]={}),void 0===a[c].streams&&(a[c].streams={}),void 0===a[c].streams[b]&&(a[c].streams[b]={}),void 0===a[c].streams[b][e]&&(a[c].streams[b][e]={}),void 0===a[c].streams[b][e][d]&&(a[c].streams[b][e][d]={}),void 0===a[c].streams[b][e][d][f]&&(g?a[c].streams[b][e][d][f]=[]:a[c].streams[b][e][d][f]=0),a}function K(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,x,A,G,H,K,L,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da=null,ea=null,fa=null,ga=b.reportType,ha=null,ia=null,ja=null,ka=null,la=null,ma=null,na=null,oa=null,pa=null,qa=b.data,ra=0,sa=M(c.streams,b.ssrc,"outbound",ga);sa?(h=z(parseInt(sa.data.bytesSent,10)),i=a.lastStatsSent.apiTS,K=z(parseInt(sa.data.packetsSent,10)),N=z(parseInt(sa.data.packetsLost,10)),O=z(parseInt(sa.data.discardedPackets,10))):(h=0,i=e,N=0,K=0,O=0),k=e,A=k-i,m=s(b,d),n=u(b,d),o=t(b,d),p=v(b,d),T=w(b,d),r(b,d,a,m),l=y(b,d),j=z(parseInt(qa.bytesSent,10)),null!==j&&null!==h&&j<h&&(h=0,Ib(za,Aa,"log",{msg:"getstats: curBytesSent < prevBytesSent counter reset",conferenceID:f,ucID:g})),void 0!==qa.droppedFrames&&(P=I(parseInt(qa.droppedFrames,10)),null!==P&&null!==O&&P<O&&(O=0),null!==P&&null!==O&&(Q=P-O)),L=I(parseInt(qa.packetsLost,10)),null!==L&&null!==N&&(ea=L-N),H=I(parseInt(qa.packetsSent,10)),null!==H&&null!==K&&(G=H-K),null!==L&&null!==H&&L>0&&(ra=L/H*100),void 0!==ea&&void 0!==G&&G+ea>0&&(fa=ea/(G+ea)),A>0&&(null!==j&&null!==h&&(da=8*(j-h)/A,H&&0!==H&&(U=j/H)),void 0!==G&&(pa=G/(A/1e3)));var ta=b.ssrc;a=J(a,ta,"rttInfo",ga,"outbound","rttArray",!0),a=J(a,ta,"fractionalLossInfo",ga,"outbound","fractionalLossArray",!0),a=J(a,ta,"timeElapse",ga,"outbound","totalTimeMs",!1),a=J(a,ta,"frameWidthInfo",ga,"outbound","frameWidthArray",!0),a=J(a,ta,"frameRateInfo",ga,"outbound","frameRateArray",!0),a=J(a,ta,"frameHeightInfo",ga,"outbound","frameHeightArray",!0),void 0!==l&&null!==l&&a.rttInfo.streams[ta].outbound[ga].rttArray.push(parseInt(l,10)),void 0!==fa&&null!==fa&&a.fractionalLossInfo.streams[ta].outbound[ga].fractionalLossArray.push(fa),void 0!==o&&null!==o&&a.frameRateInfo.streams[ta].outbound[ga].frameRateArray.push(parseInt(o,10)),void 0!==p&&null!==p&&a.frameWidthInfo.streams[ta].outbound[ga].frameWidthArray.push(parseInt(p,10)),void 0!==T&&null!==T&&a.frameHeightInfo.streams[ta].outbound[ga].frameHeightArray.push(parseInt(T,10)),ha=B(95,a.rttInfo.streams[ta].outbound[ga].rttArray),ka=B(95,a.fractionalLossInfo.streams[ta].outbound[ga].fractionalLossArray),ca=C(a.rttInfo.streams[ta].outbound[ga].rttArray),V=C(a.frameRateInfo.streams[ta].outbound[ga].frameRateArray),Y=B(50,a.frameRateInfo.streams[ta].outbound[ga].frameRateArray),_=B(95,a.frameRateInfo.streams[ta].outbound[ga].frameRateArray),W=C(a.frameHeightInfo.streams[ta].outbound[ga].frameHeightArray),Z=B(50,a.frameHeightInfo.streams[ta].outbound[ga].frameHeightArray),aa=B(95,a.frameHeightInfo.streams[ta].outbound[ga].frameHeightArray),X=C(a.frameWidthInfo.streams[ta].outbound[ga].frameWidthArray),$=B(50,a.frameWidthInfo.streams[ta].outbound[ga].frameWidthArray),ba=B(95,a.frameWidthInfo.streams[ta].outbound[ga].frameWidthArray),null!==j&&null!==h&&j>h&&(a.timeElapse.streams[ta].outbound[ga].totalTimeMs=a.timeElapse.streams[ta].outbound[ga].totalTimeMs+A),a.timeElapse.streams[ta].outbound[ga].totalTimeMs>0&&null!==j&&(oa=8*j/a.timeElapse.streams[ta].outbound[ga].totalTimeMs);var ua={csioIntMs:A,csioIntFL:fa,csioIntPR:pa,csioIntBRKbps:da,csioMediaType:m,csioSig2Latency:ha,csioAvgBRKbps:oa,csioTimeElapseMs:a.timeElapse.streams[ta].outbound[ga].totalTimeMs,csioRes:n,csioPercentileFl:ka,csioIntFramesDropped:Q,csioAvgRtt:ca,csioAvgPacketSize:U,csioPktLossPercentage:ra,csioFrameWidth95Percentile:ba,csioFrameHeight95Percentile:aa,csioFrameRate95Percentile:_,csioFrameWidth50Percentile:$,csioFrameHeight50Percentile:Z,csioFrameRate50Percentile:Y,csioFrameWidthMean:X,csioFrameHeightMean:W,csioFrameRateMean:V};for(R in qa)qa.hasOwnProperty(R)&&(ua[R]=qa[R]);return m===zb.audio?(S=ha+40,ia=D(S,m,xb),ja=E(da,m,tb),q=F(ia,ja),ua.csioMark=q,ua.csioeM=S):m===zb.video&&(ua.csioPercentileFrameWidth=B(95,a.frameWidthInfo.streams[ta].outbound[ga].frameWidthArray),ua.csioPercentileFrameRate=B(95,a.frameRateInfo.streams[ta].outbound[ga].frameRateArray),x=parseInt(a.rttInfo.streams[ta].outbound[ga].frameRate,10),la=E(o/x,m,ub),ma=D(l,m,vb),na=E(da,m,tb),q=F(la,ma,na),a.rttInfo.streams[ta].outbound[ga].frameRate=o,ua.csioMark=q),ua}function L(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,x,G,H,K,L,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja=null,ka=null,la=b.reportType,ma=null,na=null,oa=null,pa=null,qa=null,ra=null,sa=null,ta=null,ua=null,va=b.data,wa=0,xa=M(c.streams,b.ssrc,"inbound",la);xa?(h=z(parseInt(xa.data.bytesReceived,10)),l=z(parseInt(xa.data.packetsLost,10)),R=z(parseInt(xa.data.packetsReceived,10)),i=a.lastStatsSent.apiTS,T=z(parseInt(xa.data.discardedPackets,10))):(h=0,i=e,l=0,R=0,T=0),o=s(b,d),p=u(b,d),x=t(b,d),q=A(b,d),X=v(b,d),n=y(b,d),Y=w(b,d),r(b,d,a,o),j=z(parseInt(va.bytesReceived,10)),null!==j&&null!==h&&j<h&&(h=0,l=0,R=0,Ib(za,Aa,"log",{msg:"getstats: curBytesReceived < prevBytesReceived counter reset",conferenceID:f,ucID:g})),m=I(parseInt(va.packetsLost,10)),null!==m&&null!==l&&(ka=m-l),k=e,void 0!==va.discardedPackets&&(S=I(parseInt(va.discardedPackets,10)),null!==S&&null!==T&&S<T&&(T=0),null!==S&&null!==T&&(U=S-T)),Q=I(parseInt(va.packetsReceived,10)),G=Q-R,void 0!==ka&&null!==G&&G+ka>0&&(na=ka/(G+ka)),null!==m&&null!==Q&&m>0&&(wa=m/Q*100),P=k-i,P>0&&(null!==j&&null!==h&&(ja=8*(j-h)/P,Q&&0!==Q&&(Z=j/Q)),null!==G&&(ma=G/(P/1e3)));var ya=b.ssrc;a=J(a,ya,"rttInfo",la,"inbound","rttArray",!0),a=J(a,ya,"timeElapse",la,"inbound","totalTimeMs",!1),a=J(a,ya,"jitterInfo",la,"inbound","jitterArray",!0),a=J(a,ya,"fractionalLossInfo",la,"inbound","fractionalLossArray",!0),a=J(a,ya,"frameWidthInfo",la,"inbound","frameWidthArray",!0),a=J(a,ya,"frameRateInfo",la,"inbound","frameRateArray",!0),a=J(a,ya,"frameHeightInfo",la,"inbound","frameHeightArray",!0),void 0!==n&&null!==n&&a.rttInfo.streams[ya].inbound[la].rttArray.push(parseInt(n,10)),void 0!==q&&null!==q&&a.jitterInfo.streams[ya].inbound[la].jitterArray.push(parseInt(q,10)),void 0!==na&&null!==na&&a.fractionalLossInfo.streams[ya].inbound[la].fractionalLossArray.push(na),void 0!==x&&null!==x&&a.frameRateInfo.streams[ya].inbound[la].frameRateArray.push(parseInt(x,10)),void 0!==X&&null!==X&&a.frameWidthInfo.streams[ya].inbound[la].frameWidthArray.push(parseInt(X,10)),void 0!==Y&&null!==Y&&a.frameHeightInfo.streams[ya].inbound[la].frameHeightArray.push(parseInt(Y,10)),oa=B(95,a.rttInfo.streams[ya].inbound[la].rttArray),pa=B(95,a.jitterInfo.streams[ya].inbound[la].jitterArray),qa=B(95,a.fractionalLossInfo.streams[ya].inbound[la].fractionalLossArray),$=C(a.frameRateInfo.streams[ya].inbound[la].frameRateArray),ba=B(50,a.frameRateInfo.streams[ya].inbound[la].frameRateArray),ea=B(95,a.frameRateInfo.streams[ya].inbound[la].frameRateArray),_=C(a.frameHeightInfo.streams[ya].inbound[la].frameHeightArray),ca=B(50,a.frameHeightInfo.streams[ya].inbound[la].frameHeightArray),fa=B(95,a.frameHeightInfo.streams[ya].inbound[la].frameHeightArray),aa=C(a.frameWidthInfo.streams[ya].inbound[la].frameWidthArray),da=B(50,a.frameWidthInfo.streams[ya].inbound[la].frameWidthArray),ga=B(95,a.frameWidthInfo.streams[ya].inbound[la].frameWidthArray),ha=C(a.jitterInfo.streams[ya].inbound[la].jitterArray),ia=C(a.rttInfo.streams[ya].inbound[la].rttArray),null!==j&&null!==h&&j>h&&(a.timeElapse.streams[ya].inbound[la].totalTimeMs=a.timeElapse.streams[ya].inbound[la].totalTimeMs+P),null!==j&&a.timeElapse.streams[ya].inbound[la].totalTimeMs>0&&(ua=8*j/a.timeElapse.streams[ya].inbound[la].totalTimeMs);var Ba={csioIntMs:P,csioIntFL:na,csioIntPR:ma,csioIntBRKbps:ja,csioSig2Latency:oa,csioAvgBRKbps:ua,csioMediaType:o,csioTimeElapseMs:a.timeElapse.streams[ya].inbound[la].totalTimeMs,csioIntPktRcv:G,csioIntPktLoss:ka,csioPercentileJitter:pa,csioRes:p,csioPercentileFl:qa,csioIntPktDiscarded:U,csioAvgJitter:ha,csioAvgRtt:ia,csioAvgPacketSize:Z,csioPktLossPercentage:wa,csioFrameWidth95Percentile:ga,csioFrameHeight95Percentile:fa,csioFrameRate95Percentile:ea,csioFrameWidth50Percentile:da,csioFrameHeight50Percentile:ca,csioFrameRate50Percentile:ba,csioFrameWidthMean:aa,csioFrameHeightMean:_,csioFrameRateMean:$};for(V in va)va.hasOwnProperty(V)&&(Ba[V]=va[V]);return o===zb.audio?(W=oa+40,ra=D(W,o,xb),sa=D(na,o,wb),ta=E(ja,o,tb),H=F(ra,sa,ta),Ba.csioMark=H,Ba.csioeM=W):o===zb.video&&(Ba.csioPercentileFrameRate=B(95,a.frameRateInfo.streams[ya].inbound[la].frameRateArray),Ba.csioPercentileFrameWidth=B(95,a.frameWidthInfo.streams[ya].inbound[la].frameWidthArray),K=a.rttInfo.streams[ya].inbound[la].frameRate,L=E(x/K,o,ub),N=D(n,o,vb),O=E(ja,o,tb),H=F(L,N,O),a.rttInfo.streams[ya].inbound[la].frameRate=x,Ba.csioMark=H),Ba}function M(a,b,c,d){var e=a.filter(function(a){return a.ssrc===b&&a.streamType===c&&a.reportType===d});return e.length>0?e[0]:null}function N(a,b,c,d,e,f){var g={streams:[]};g.fabricState=a.pcState,g.connectionState=q();var h=null;return h=a.lastStatsSent?a.lastStatsSent.statistics:{streams:[]},b.streams.forEach(function(b){var i={cname:b.cname,usage:b.usage,msid:b.msid,userID:b.userID,associatedVideoTag:b.associatedVideoTag,ssrc:b.ssrc,streamType:b.streamType,reportType:b.reportType};"inbound"===b.streamType?i.data=L(a,b,h,c,d,e,f):i.data=K(a,b,h,c,d,e,f),g.streams.push(i)}),g}function O(a){var b,c,d;for(b in a.streams)if(a.streams.hasOwnProperty(b)){if(a.streams[b].inbound)for(d in a.streams[b].inbound)a.streams[b].inbound.hasOwnProperty(d)&&(c=a.streams[b].inbound[d].mark,c===pb.bad?a.streams[b].inbound[d].mark=2:c===pb.fair?a.streams[b].inbound[d].mark=1:a.streams[b].inbound[d].mark=0);if(a.streams[b].outbound)for(d in a.streams[b].outbound)a.streams[b].outbound.hasOwnProperty(d)&&(c=a.streams[b].outbound[d].mark,c===pb.bad?a.streams[b].outbound[d].mark=2:c===pb.fair?a.streams[b].outbound[d].mark=1:a.streams[b].outbound[d].mark=0)}return a}function P(a,b,c){var d,e,f;for(d=0;d<a.length;d++)e=b[a[d].localCandidateId],f=c[a[d].remoteCandidateId],a[d].localAddr=e.ipAddress+":"+e.portNumber,a[d].remoteAddr=f.ipAddress+":"+f.portNumber,a[d].localAddrType=e.candidateType,a[d].remoteAddrType=f.candidateType,a[d].transportType=e.transport;return a}function Q(a){var b={},c=Zc.getConferenceURL();return a.connectionState&&(b.connectionState=a.connectionState),a.fabricState&&(b.fabricState=a.fabricState),c&&(b.conferenceURL=c),b.streams={},a.streams.forEach(function(a){var c={cname:a.cname,ssrc:a.ssrc,msid:a.msid,remoteUserID:a.userID,usageLabel:a.usage,associatedVideoTag:a.associatedVideoTag};a.data.hasOwnProperty("csioIntFL")&&(c.fractionLoss=a.data.csioIntFL),a.data.hasOwnProperty("csioIntBRKbps")&&(c.bitrate=a.data.csioIntBRKbps),a.data.hasOwnProperty("csioMark")&&(c.quality=a.data.csioMark),a.data.hasOwnProperty("csioMediaType")&&(c.mediaType=a.data.csioMediaType),a.data.hasOwnProperty("googRtt")&&(c.rtt=a.data.googRtt),a.data.hasOwnProperty("mozRtt")&&(c.rtt=a.data.mozRtt),a.data.hasOwnProperty("roundTripTime")&&(c.rtt=a.data.roundTripTime),a.data.hasOwnProperty("jitter")&&(c.jitter=a.data.jitter),a.data.hasOwnProperty("googJitterReceived")&&(c.jitter=a.data.googJitterReceived),a.data.hasOwnProperty("audioOutputLevel")&&(c.audioOutputLevel=a.data.audioOutputLevel),a.data.hasOwnProperty("audioInputLevel")&&(c.audioInputLevel=a.data.audioInputLevel),a.data.hasOwnProperty("csioAvgRtt")&&(c.averageRTT=a.data.csioAvgRtt),a.data.hasOwnProperty("csioAvgJitter")&&(c.averageJitter=a.data.csioAvgJitter),a.data.hasOwnProperty("csioPktLossPercentage")&&(c.packetLossPercentage=a.data.csioPktLossPercentage),b.streams[a.ssrc]=c}),b}function R(a,b,c,e,f,g){var h=d();a.hasOwnProperty("token")&&a.hasOwnProperty("ucID")&&!Za?(ja(gb.processedStats,a,g),b.latestEventSent=h,b.lastFabricState=b.pcState):(a.clockUnsynced=Za,Pa.cacheEvent({channel:gb.processedStats,data:a}),a.hasOwnProperty("token")||Ra.sendAuthenticationRequest(za,f))}function S(a,b){for(var c in b)b.hasOwnProperty(c)&&"id"!==c&&"type"!==c&&(a[c]=b[c]);return a}function T(a,b,e,f,i,j,k){function l(l){var m=d(),n=c();void 0===j.lastRawStatsSentInterval||null===j.lastRawStatsSentInterval?j.lastRawStatsSentInterval=n-j.statsPollingStart:j.lastRawStatsSentInterval=n-j.rawstatsTS+j.lastRawStatsSentInterval,void 0===j.lastProcessedStatsSentInterval||null===j.lastProcessedStatsSentInterval?j.lastProcessedStatsSentInterval=n-j.statsPollingStart:j.lastProcessedStatsSentInterval=n-j.rawstatsTS+j.lastProcessedStatsSentInterval,j.rawstatsTS=n;var o={},q=Ta.codebase;o.version=va,o.appID=za,o.conferenceID=encodeURIComponent(f),o.apiTS=m,o.timeShift=0,o.fabricState=j.pcState,o.pcID=j.pcHash,void 0!==i&&(o.ucID=i),Ra.authToken?o.token=Ra.authToken:Ra.sendAuthenticationRequest(za,b),o.localID=encodeURIComponent(b),o.remoteID=encodeURIComponent(e),o.deviceID=Ca;var r,s,t,u,v,w,x,y={streams:[]},z=null,A=!1,B=!1,C={},D={};for(z=fc(l),r=0;r<z.length;++r)if(s=Y(z[r]),t=V(s),!Z(t))if(t.hasOwnProperty("Transport"))u="Transport",y.hasOwnProperty(u)||(y[u]=[]),q!==yb.firefox?(parseInt(t[u].bytesReceived,10)>0||parseInt(t[u].bytesSent,10)>0)&&(y[u].push(t[u]),"true"===t[u].googActiveConnection&&(o.activeConnectionIndex=y[u].length)):(y[u].push(t[u]),"true"===t[u].selected&&(o.activeConnectionIndex=y[u].length));else if(t.localCandidate)C[t.localCandidate.id]=t.localCandidate;else if(t.remoteCandidate)D[t.remoteCandidate.id]=t.remoteCandidate;else if(t.bwe)y.bwe=t.bwe;else if(t.trackStats)y.trackStats||(y.trackStats=[]),y.trackStats.push(t.trackStats);else if(t.codec)y.codec||(y.codec=[]),y.codec.push(t.codec);else if(t.candidatePair)y.candidatePair||(y.candidatePair=[]),y.candidatePair.push(t.candidatePair);else{w=Ob(j,t.ssrc),void 0!==w&&w.localStartTime||(x=Qb(e,f,i,j,k,null),x&&(B=!0),w=Ob(j,t.ssrc)),w&&(v=w.remoteUserID),void 0===v&&(v=e);var E={userID:v,data:t.data,reportType:t.reportType,streamType:t.streamType,ssrc:t.ssrc};void 0!==w&&(E.cname=w.cname,E.msid=w.msid,E.associatedVideoTag=w.associatedVideoTag,E.usage=w.usageLabel),y.streams.push(E)}q===yb.firefox&&(y.Transport=P(y.Transport,C,D));var F;if(y.Transport)for(F=0;F<y.Transport.length;F++)y.Transport[F].hash=p(y.Transport[F],q);o.statistics=y,y.Transport&&(A=X(y.Transport,j)),A&&Nc(k,fb.fabricTransportSwitch,f),j.pcState===qb.disrupted&&aa(o),y.trackStats&&(y=Sc(y)),y.Transport&&y.candidatePair&&(y=Rc(y));var G=N(j,y,q,m,f,i);if(y.Transport&&(G.Transport=H(j,y.Transport,q,m)),y.bwe&&(G.bwe=y.bwe),void 0===j.processedStatsTupleArray&&(j.processedStatsTupleArray=[]),ra){var I=Q(G);ra(I)}G.apiTS=m,G.batteryStatus={},G.batteryStatus.batteryLevel=g(),G.batteryStatus.isBatteryCharging=h(),G=O(G),j.processedStatsTupleArray.push(G),o.processedStatistics=j.processedStatsTupleArray,j.lastStatsSent=o;var J=la(o),K=la(o);delete J.processedStatistics,delete K.statistics,B&&Rb(fb.ssrcMap,e,f,i,Pb(j),j.pcHash),(j.lastProcessedStatsSentInterval>=Ga||j.initialPhaseOver)&&(j.processedStatsTupleArray=[],R(K,j,f,e,b,a),j.lastProcessedStatsSentInterval=0)}return l}function U(a){var b;return rb.hasOwnProperty(a)?a===rb.createOffer||a===rb.createAnswer||a===rb.setRemoteDescription?b=sb.negotiationFailure:a===rb.setLocalDescription?b=sb.sdpError:a===rb.addIceCandidate?b=sb.sdpError:a===rb.getUserMedia?b=sb.mediaConfigError:a===rb.iceConnectionFailure?b=sb.iceFailure:a===rb.signalingError?b=sb.signalingError:(a===rb.applicationLog||rb.applicationError)&&(b=sb.applicationLog):b=Jb.invalidWebRTCFunctionName,b}function V(a){var b={};return"inboundrtp"===a.type||"outboundrtp"===a.type||"inbound-rtp"===a.type||"outbound-rtp"===a.type?(b.ssrc=a.ssrc,b.streamType="inboundrtp"===a.type||"inbound-rtp"===a.type?"inbound":"outbound",b.data=a,void 0!==a.isRemote?b.reportType="true"===a.isRemote?"remote":"local":b.reportType="local",a.trackId&&(b.trackId=a.trackId),a.mediaType&&(b.mediaType=a.mediaType)):"candidatepair"===a.type&&a.selected?b.Transport=a:"localcandidate"===a.type||"local-candidate"===a.type?b.localCandidate=a:"remotecandidate"===a.type||"remote-candidate"===a.type?b.remoteCandidate=a:"transport"===a.type||"googCandidatePair"===a.type?b.Transport=a:"VideoBwe"===a.type?b.bwe=a:"track"===a.type?b.trackStats=a:"candidate-pair"===a.type?b.candidatePair=a:"codec"===a.type?b.codec=a:"ssrc"===a.type&&(b.reportType="local",a.bytesSent?b.streamType="outbound":b.streamType="inbound",b.ssrc=a.ssrc,b.data=a),b}function W(a){var b="None";switch(a){case 0:b="TURN/TLS";break;case 1:b="TURN/TCP";break;case 2:b="TURN/UDP"}return b}function X(a,b){var c,d,e,f,g,h,i,j,k,l=!1,m="None",n=!1,o=function(a){if(a.typePreference){var b=a.typePreference>>24;return"rtp"===a.protocol&&a.address===c&&(b>=0&&b<=2&&(m=W(b)),!0)}return!1};for(i=0;i<a.length;i++)if(j=a[i],navigator.mozGetUserMedia&&"candidatepair"===j.type&&"true"===j.selected?(n=!0,c=j.localAddr,d=j.remoteAddr,e=j.localAddrType,f=j.remoteAddrType,g=j.transportType):"googCandidatePair"===j.type&&"true"===j.googActiveConnection?(n=!0,c=j.googLocalAddress,d=j.googRemoteAddress,e=j.googLocalCandidateType,f=j.googRemoteCandidateType,g=j.googTransportType):"transport"===j.type&&(n=!0,j.selectedCandidatePairId&&(k=j.selectedCandidatePairId)),n){c&&(h=0===c.indexOf("[")),b.iceCandidates.some(o);break}if(!n)return l;var p=b.transportData;return void 0!==p&&p.localAddr===c&&p.remoteAddr===d&&p.transportType===g&&p.selectedCandidatePairId===k||(b.transportData={localAddr:c,remoteAddr:d,localAddrType:e,remoteAddrType:f,transportType:g,ipv6:h,relayType:m,selectedCandidatePairId:k},l=!0),l}function Y(a){var b={};a.timestamp instanceof Date&&(b.timestamp=a.timestamp.getTime().toString()),a.type&&(b.type=a.type);var c=0;if(a.names){var d=a.names();for(c=0;c<d.length;++c)b[d[c]]=a.stat(d[c])}else{var e;for(e in a)a.hasOwnProperty(e)&&(b[e]=a[e])}return b}function Z(a){if(null===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;var b;for(b in a)if(a.hasOwnProperty(b))return!1;return!0}function $(a){return{magicKey:a,statsSubmissionInterval:Ja,endpoint:Va,localUserIDObject:Ba}}function _(a,b,c){var d=Wa[a];void 0===d&&(Wa[a]={},Wa[a].participants=null,c&&(Wa[a].userJoinedSent=!0),b&&(Wa[a].refreshPresence=b))}function aa(a){var b,c=a.statistics.outbound;if(void 0!==c)for(b in c)c.hasOwnProperty(b)&&(navigator.mozGetUserMedia&&c[b].data.mozRtt?c[b].data.mozRtt=0:c[b].data.googRtt&&(c[b].data.googRtt=0))}function ba(a){return clearInterval(a),null}function ca(){var a;for(a in Wa)Wa.hasOwnProperty(a)&&(Wa[a].refreshPresence=ba(Wa[a].refreshPresence),delete Wa[a].refreshPresence);na()}function da(a){var b=Wa[a],c=!1;return void 0!==b&&b.participants&&b.participants.length>0&&(c=!0),c}function ea(a,b){var c=Wa[a],d=[];if(void 0===c)d.push(b),Wa[a].participants=d;else{var e=c.participants;null===e?(d.push(b),c.participants=d):e.push(b)}}function fa(a){var b=!1;if(!Wa[a])return{conferenceFinished:b,ucID:null};var c=Wa[a].ucID;return 0===Wa[a].participants.length&&(ba(Wa[a].refreshPresence),na(),Pa.sendCachedEvents(Ra),delete Wa[a],b=!0),{conferenceFinished:b,ucID:c}}function ga(a,b){Rb(fb.userLeft,null,a,b,null,null,null),_a=ba(_a),na(),$a=Mb,Mb=null}function ha(){var a,b=function(a){return setInterval(function(){Vb(a)},La)};for(a in Wa)Wa.hasOwnProperty(a)&&(Vb(a),Wa[a].refreshPresence=b(a));oa()}function ia(a){try{if(window&&window.sessionStorage){var b=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));if(b&&b[a])return b[a].ucID}}catch(a){return null}return null}function ja(a,b,c){var d=b.action;b.channel=a,Ra._isTokenValid(Ra.authToken,za,Aa)?Za&&Bb.indexOf(d)===-1?(b.clockUnsynced=Za,Pa.cacheEvent({channel:a,data:b,callback:c})):(b.token=Ra.authToken,$c(a,b,c),c&&d&&c(ib.success,d+" sent to the backend.")):Ra.sendAuthenticationRequest(za,Aa,function(e,f){e!==ib.success?(e===jb.authOngoing&&(b.clockUnsynced=Za,Pa.cacheEvent({channel:a,data:b,callback:c})),c&&e!==jb.authOngoing&&c(e,f)):e===ib.success&&"SDK authentication successful."===f&&(Za&&Bb.indexOf(d)===-1?(b.clockUnsynced=Za,Pa.cacheEvent({channel:a,data:b,callback:c})):(b.token=Ra.authToken,$c(a,b,c),c&&d&&c(ib.success,d+" sent to the backend.")))})}function ka(a){a&&a(jb.authOngoing,null)}function la(a){if(null===a||"object"!=typeof a)return a;var b,c=new a.constructor;for(b in a)a.hasOwnProperty(b)&&(c[b]=la(a[b]));return c}function ma(){var a={};Object.keys(Wa).forEach(function(b){var c=Wa[b];if(!c)return!0;var d,e,f={ucID:c.ucID,userJoinedSent:c.userJoinedSent},g=[];if(c.participants){var h,i=c.participants;for(d=0;d<i.length;d++)e={},h=i[d],e={pcID:h.pcHash,pcState:h.pcState,iceConnectionState:h.iceConnectionState,iceGatheringState:h.iceGatheringState,iceCandidatesNumber:h.iceCandidates.length,remoteUserID:h.remoteUserID},g.push(e)}f.participants=g,a[b]=f});var b={authStatus:!!Ra.tokenData,clockSync:!Za,stateMachine:a,pageURL:window.location.href,eventType:"warn",version:va};b.wsStatus=Zc.getWSConnectionState(),Ib(za,Aa,"stateMachine",b)}function na(){ab||(ab=setInterval(function(){ma()},bb))}function oa(){ba(ab),ab=null}var pa,qa,ra,sa=a("./callstatsUtils"),ta="https://collector.callstats.io:443/",ua="https://auth.callstats.io/",va="3.18.2",wa="wss://collector.callstats.io:443/csiows/collectCallStats",xa="https://dashboard.callstats.io/apps/",ya="https://dashboard.callstats.io/api-internal/v1/qmodelthresholds",za=null,Aa=null,Ba=null,Ca=null,Da=!1,Ea=!1,Fa=3e4,Ga=1e4,Ha=1e4,Ia=2e4,Ja=15e3,Ka=!1,La=1e4,Ma=5e3,Na=!1,Oa=function(){function a(a,b){setTimeout(function(){var b=d(),c=b-a.data.apiTS;a.data.timeShift=c,ja(a.channel,a.data,a.callback)},b)}var b=[];this.sendCachedEvents=function(c,e,f,g,h,i){if(!c.authToken)return void c.sendAuthenticationRequest(za,Aa);if(!e){var j,k,l,m,n=d(),o=[],p=Math.max(Ja/b.length,cb);for(j=0;j<b.length;j++)if(l=b[j],l.data.action!==fb.userJoined){if(l.data.token=c.authToken,f&&l.data.apiTS>=n-g||!l.data.ucID)if(m=decodeURIComponent(l.data.conferenceID),Wa[m]&&Wa[m].ucID)l.data.ucID=Wa[m].ucID;else{if(m!==h){o.push(b[j]);continue}l.data.ucID=i}if(l.data.clockUnsynced&&(l.data.apiTS+=Ya.currentOffset),l.channel===gb.processedStats&&l.data.clockUnsynced&&l.data.processedStatistics&&l.data.processedStatistics.length>0)for(k=0;k<l.data.processedStatistics.length;k++)l.data.processedStatistics[k].apiTS+=Ya.currentOffset;delete l.data.clockUnsynced,a(l,p*(j+1))}else o.push(b[j]);b=o}},this.sendCachedUserJoinedEvents=function(c){if(!c.authToken)return void c.sendAuthenticationRequest(za,Aa);var d,e,f=[],g=Math.max(Ja/b.length,cb);for(d=0;d<b.length;d++)e=b[d],e.data.action===fb.userJoined||e.data.action===eb.fabricSetupFailed?(e.data.token=c.authToken,e.data.clockUnsynced&&(e.data.apiTS=e.data.apiTS+Ya.currentOffset),e.data.value&&(e.data.value.statsSubmissionInterval=Ja),a(e,g*(d+1))):f.push(b[d]);b=f},this.cacheEvent=function(a){b.push(a)},this.sendCachedFeedback=function(){var a=Db("feedback"),b=JSON.parse(Db("csio_auth_data"));if(a&&b){var c=JSON.parse(a),d=b===c.token;d||Aa!==c.userID||(c.token=b,d=!0),d?ja(gb.userFeedback,c):Eb("feedback")}}},Pa=new Oa,Qa=function(){var a=this,b="urn:x-callstats:auth:errorActions",c=.9,e=3600;this.authInProgress=!1,this.tokenData=null,this.authToken=null,this.tokenGenerator=function(a,b){b("Token generator not set")};var f=null,g=null,h=!1,i=window.atob,j=window.btoa,k=function(a){return j(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")},l=function(a){for(var b=i(a.replace(/[ \r\n]+$/,"")),c=[],d=0;d<b.length;++d){var e=b.charCodeAt(d).toString(16);1===e.length&&(e="0"+e),c.push(e)}return c.join("")},m={};m.cryptotype=null,window.crypto&&window.crypto.subtle?(m.cryptotype="standard",m.subtlecrypto=window.crypto.subtle):window.crypto&&!window.crypto.subtle&&window.crypto.webkitSubtle?(m.cryptotype="webkit",m.subtlecrypto=window.crypto.webkitSubtle):window.msCrypto&&window.msCrypto.subtle?(m.cryptotype="ie",m.subtlecrypto=window.msCrypto.subtle):(m.subtlecrypto=null,console.info("WebCryptography API not supported in this browser.")),m.sign=function(a,b,c,d){if("HS256"!==a.alg)return d("Use header.alg=HS256");a=JSON.stringify(a),"string"!=typeof b&&(b=JSON.stringify(b));for(var e=k(a)+"."+k(b),f=new ArrayBuffer(e.length),g=new Uint8Array(f),h=e.length-1;h>=0;h--)g[h]=e.charCodeAt(h);var i=function(a){for(var b="",c=new Uint8Array(a),f=c.byteLength,g=0;g<f;g++)b+=String.fromCharCode(c[g]);return e+="."+k(b),d(null,e)},j=function(a){return d(a)},l={name:"HMAC"};"ie"!==m.cryptotype&&"webkit"!==m.cryptotype||(l.hash={name:"sha-256"});var n=m.subtlecrypto.sign(l,c,g);
"ie"===m.cryptotype?(n.onerror=j,n.oncomplete=function(a){i(a.target.result)}):n.then(i).catch(j)},m.decode=function(a){try{return JSON.parse(i(a.split(".")[1]))}catch(a){return console.error("Couldn't decode token. ",a),null}},m.importKey=function(a,b,c){if("webkit"===m.cryptotype)for(;a.length<32;)a+="\0";var d={kty:"oct",k:k(a),alg:"HS256"},e={name:"HMAC",hash:{name:"SHA-256"}};if("ie"===m.cryptotype?d.extractable=!1:d.ext=!1,"webkit"===m.cryptotype&&(e=null,d.use="sig"),"ie"===m.cryptotype||"webkit"===m.cryptotype){var f=JSON.stringify(d);d=new Uint8Array(f.length);for(var g=0;g<f.length;g++)d[g]=f.charCodeAt(g)}var h=m.subtlecrypto.importKey("jwk",d,e,!1,["sign"]);"ie"===m.cryptotype?(h.onerror=c,h.oncomplete=function(a){b(a.target.result)}):h.then(b).catch(c)},this._isTokenValid=function(a,b,c){var e=!1;if(null===a)return!1;try{var f=m.decode(a);if(null!==f&&f.appID===b&&f.userID===encodeURIComponent(c)){var g=null;if(navigator.mozGetUserMedia){var h=f.expiry.split(" ").join("T");g=Date.parse(h)}else g=new Date(f.expiry);var i=new Date(d());i<g&&(e=!0)}return e}catch(a){}return!1},this.setupAuthToken=function(a){Cb("csio_auth_data",JSON.stringify(a)),this.authToken=a,this.tokenData=m.decode(a),Ja=parseInt(this.tokenData.submissionInterval,10),Ka=this.tokenData.collectSDP},this.sendAuthenticationRequest=function(d,e,g){if(d&&e){if(a.authInProgress)return void ka(g);null!==f&&(clearTimeout(f),f=null),n(),a.authInProgress=!0,a.tokenGenerator(h,function(i,j){if(null!==i)return a.authInProgress=!1,void(g&&g(ib.tokenGenerationError,i.toString()));var k=ua+"authenticate",l={client_id:e+"@"+za,code:j,grant_type:"authorization_code"};Uc(k,l,function(i){var j=null;a.authInProgress=!1;try{j=JSON.parse(i.response)}catch(a){console.error("Authentication response parse error")}if(!j)return void(f=setTimeout(a.sendAuthenticationRequest,Ma,d,e,g));if(200===i.status){if("bearer"!==j.token_type)return console.error("Authentication was successful, but token type was not bearer. Scheduling retry."),void(f=setTimeout(a.sendAuthenticationRequest,Ma,d,e,g));a.setupAuthToken(j.access_token);var k=parseInt(1e3*parseInt(j.expires_in)*c);o(k,d,e,g),h=!1,g&&g(ib.success,"SDK authentication successful."),Zc._isChannelReady()?(Pa.sendCachedUserJoinedEvents(Ra),g&&g(ib.success,"WebSocket establishment successful.")):Zc._setupWebSocketConnection(function(a,b){g&&g(a,b)})}else{if(j[b]&&j[b].length>0)return p(d,e,g,j[b]);console.error("Authentication failed, but no error actions were defined in response."),f=setTimeout(a.sendAuthenticationRequest,Ma,d,e,g)}})})}};var n=function(){null!==g&&(clearTimeout(g),g=null)},o=function(b,c,d,e){n(),g=setTimeout(function(){a.sendAuthenticationRequest(c,d,e)},b)},p=function(a,b,c,d){if(0!==d.length){var e=d.shift();return e.action===Kb.RETRY?(o(e.params.timeout,a,b,c),p(a,b,c,d)):e.action===Kb.GET_NEW_TOKEN?(h=!0,p(a,b,c,d)):e.action===Kb.REPORT_ERROR?p(a,b,c,d):void 0}};this.appSecretTokenGenerator=function(b){var c=null,f=null,g=!1,h=null;b.indexOf(":")>-1&&(h=l(b.split(":")[0]),b=b.split(":")[1]);var i=function(a){b=null,c=a},j=function(a){g=!0,b=null,console.error("Couldn't import key",a)};return m.importKey(b,i,j),function(b,i){if(g)return i("appsecret based token generation failed");if(!b&&null!==f)return i(null,f);if(null===c)return setTimeout(function(){a.tokenGenerator(b,i)},100);var j={userID:Aa,appID:za,exp:parseInt(d()/1e3)+e,nbf:parseInt(d()/1e3)-e};h&&(j.keyID=h),m.sign({alg:"HS256"},j,c,function(a,b){return a?i(a):(f=b,i(null,b))})}}},Ra=new Qa,Sa=new sa,Ta=Sa.detectBrowserInfo(),Ua=Sa.measureAppLoadingPerformance(Ta),Va={type:"browser",name:Ta.name,ver:Ta.ver,os:Ta.os,osVersion:Ta.osVersion,userAgent:Ta.userAgent},Wa={},Xa={statsSubmissionIntervalInMS:[1e3,2e3,5e3,1e4],statsSubmissionPhaseDurationInMS:[1e4,3e4,8e4,18e4]},Ya={currentOffset:0,offsetResults:[],syncStartTime:null,syncAttempts:5,syncHandler:null,maxAllowedLatency:6e4},Za=!0,$a=null,_a=null,ab=null,bb=2e4,cb=100,db=null;"Firefox"===Ta.name?db=mozRTCPeerConnection:"Chrome"===Ta.name||"Opera"===Ta.name?db=webkitRTCPeerConnection:"Safari"===Ta.name||"Edge"===Ta.name&&(db=window.RTCPeerConnection);var eb={fabricSetup:"fabricSetup",fabricSetupFailed:"fabricSetupFailed",fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricStats:"fabricStats",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",userIDChangedEvent:"userIDChangedEvent",activeDeviceList:"activeDeviceList",applicationErrorLog:"applicationErrorLog"},fb={autoFabricSetup:"autoFabricSetup",autoFabricSetupFailed:"autoFabricSetupFailed",userJoined:"userJoined",userLeft:"userLeft",fabricStatsCaching:"fabricStatsCaching",refreshPresence:"userAlive",ssrcMap:"ssrcMap",mediaPlaybackStartEvent:"mediaPlaybackStartEvent",mediaSuspendedEvent:"mediaSuspendedEvent",fabricStateChange:"fabricStateChange",iceDisruptionStart:"iceDisruptionStart",iceDisruptionEnd:"iceDisruptionEnd",fabricTransportSwitch:"fabricTransportSwitch",iceConnectionDisruptionStart:"iceConnectionDisruptionStart",iceConnectionDisruptionEnd:"iceConnectionDisruptionEnd",iceAborted:"iceAborted",iceTerminated:"iceTerminated",iceFailed:"iceFailed",iceRestarted:"iceRestarted",fabricDropped:"fabricDropped",connectedDevices:"connectedDevices"},gb={sdpSubmission:"sdpSubmissionEvent",rtpStats:"rtpStats",processedStats:"processedStats",callStatsEvent:"callStatsEvent",registerPresence:"registerPresence",userFeedback:"userFeedbackEvent",clockSync:"clockSync"},hb={success:"success",failure:"failure"},ib={httpError:"httpError",authError:"authError",wsChannelFailure:"wsChannelFailure",success:"success",csProtoError:"csProtoError",appConnectivityError:"appConnectivityError",tokenGenerationError:"tokenGenerationError",ok:"OK"},jb={authOngoing:"authOngoing"},kb={audio:"audio",video:"video",data:"data",screen:"screen",multiplex:"multiplex",unbundled:"unbundled"},lb={local:"local",remote:"remote"},mb={excellent:5,good:4,fair:3,poor:2,bad:1},nb={local:"local",remote:"remote",inbound:"inbound",outbound:"outbound"},ob={excellent:3,fair:2,bad:1},pb={excellent:"excellent",fair:"fair",bad:"bad"},qb={established:"established",initializing:"initializing",failed:"failed",disrupted:"disrupted",checkingDisrupted:"checkingDisrupted"},rb={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationError:"applicationError",applicationLog:"applicationLog"},sb={mediaConfigError:"MediaConfigError",negotiationFailure:"NegotiationFailure",sdpError:"SDPGenerationError",iceFailure:"IceConnectionFailure",transportFailure:"TransportFailure",signalingError:"SignalingError",applicationError:"ApplicationError",applicationLog:"ApplicationLog"},tb={video:{gThreshold:1024,rThreshold:256},audio:{gThreshold:30,rThreshold:8}},ub={video:{gThreshold:.8,rThreshold:.3}},vb={video:{gThreshold:400,rThreshold:1e3}},wb={video:{gThreshold:10,rThreshold:50},audio:{gThreshold:15,rThreshold:30}},xb={audio:{gThreshold:240,rThreshold:400}},yb={chrome:"Chrome",firefox:"Firefox",edge:"Edge"},zb={unknown:"unknown",audio:"audio",video:"video"},Ab={signalingState:"signalingState",iceConnectionState:"iceConnectionState",iceGatheringState:"iceGatheringState"},Bb=[fb.userJoined,fb.refreshPresence,eb.fabricSetupFailed,eb.applicationErrorLog],Cb=function(a,b){try{window&&window.localStorage&&window.localStorage.setItem(a,b)}catch(a){return}},Db=function(a){try{if(window&&window.localStorage)return window.localStorage.getItem(a)}catch(a){return null}return null},Eb=function(a){try{window&&window.localStorage&&window.localStorage.removeItem(a)}catch(a){return}},Fb=function(){if(Ca=Db("endpointID"),null===Ca){var a=c(),b=Math.random()*a;rc(b.toString(),function(a){Ca=a,Cb("endpointID",Ca)})}},Gb=function(a,b){var d=null,e=null,f=null,g=new XMLHttpRequest;g.timeout=5e3,g&&(g.open("GET",encodeURI(a)),d=c(),g.onload=function(){e=c(),f=e-d,b(g,f)},g.ontimeout=function(){Za&&Wc()},g.send())},Hb=function(a,b,c){var d=new XMLHttpRequest;d&&(d.open("POST",encodeURI(a)),d.setRequestHeader("Content-Type","application/json"),d.onload=function(){c(d)},d.send(b))},Ib=function(a,b,c,d){if(Na){var e=ta+"generics",f={appID:a,userID:encodeURIComponent(b),version:va,eventType:c,data:d};Hb(e,JSON.stringify(f),function(a){200===a.status||200!==a.status})}};window.addEventListener("error",function(a){if(a&&a.filename&&a.filename.indexOf("callstats")>-1){var b,c=!1,d={fileName:a.filename,line:a.lineno,col:a.colno,jsVersion:va,eventType:"error",message:a.message,pageURL:window.location.href};for(b in Wa)Wa.hasOwnProperty(b)&&(d.conferenceID=b,Ib(za,Aa,"onErrorLog",d),c=!0);c||Ib(za,Aa,"onErrorLog",d)}});var Jb={invalidWebRTCFunctionName:"Invalid WebRTC function name"},Kb={RETRY:0,GET_NEW_TOKEN:1,REPORT_ERROR:2},Lb="fabricSetupFailed error reported by the developer",Mb=b(),Nb=function(a,b,e){var f=RegExp.prototype.test.bind(/^([a-z])=(.*)/),g=/^ssrc:(\d*) ([\w_]*):(.*)/,h=/^ssrc-group:SIM (\d*)/;b.split(/(\r\n|\r|\n)/).filter(f).forEach(function(b){var f=b[0],i=b.slice(2);if("a"===f){if(g.test(i)){var j=i.match(g),k=j[1];void 0===a.ssrcMap[k]&&(a.ssrcMap[k]={}),a.ssrcMap[k][j[2]]=j[3],a.ssrcMap[k].localStartTime=c(),a.ssrcMap[k].syncedStartTime=d(),a.ssrcMap[k].streamType=e}h.test(i)&&(void 0===a.ssrcMap.ssrcGroup&&(a.ssrcMap.ssrcGroup={},a.ssrcMap.ssrcGroup[e]={}),a.ssrcMap.ssrcGroup[e].simulcastGroup=i.match(/\d+/g))}})},Ob=function(a,b){return a.ssrcMap[b]},Pb=function(a){return a.ssrcMap},Qb=function(a,b,c,d,e,f){if(!e.localDescription||!e.remoteDescription)return!1;var g=e.localDescription.sdp,h=e.remoteDescription.sdp;if(!g||!h||g===d.localSDP&&h===d.remoteSDP)return!1;if(Nb(d,g,nb.outbound),Nb(d,h,nb.inbound),Ka){var i={sdp:{}};i.sdp.localSDP=g!==d.localSDP?g:-1,i.sdp.remoteSDP=h!==d.remoteSDP?h:-1,Sb(a,b,c,i,d.pcHash,f)}return d.localSDP=g,d.remoteSDP=h,!0},Rb=function(a,b,c,e,f,g,h){if(!a)return void console.error("sendEvent: Invalid eventType ");var i=d(),j={version:va,apiTS:i,action:a,localID:encodeURIComponent(Aa),remoteID:encodeURIComponent(b),conferenceID:encodeURIComponent(c),timeShift:0,appID:za,ucID:e,pcID:g,deviceID:Ca,value:f};return null===b&&(j.remoteID=null),null===c?void Ib(za,Aa,"log",{msg:"conferenceID is null in sendEvent for "+a}):void(e&&!Za||a===fb.userJoined||a===eb.fabricSetupFailed||a===fb.refreshPresence?(j.token=Ra.authToken,ja(gb.callStatsEvent,j,h)):(j.clockUnsynced=Za,a!==fb.fabricStatsCaching&&a!==fb.refreshPresence&&Pa.cacheEvent({channel:gb.callStatsEvent,data:j,callback:h})))},Sb=function(a,b,c,e,f,g){var h=d(),i={version:va,appID:za,conferenceID:encodeURIComponent(b),ucID:c,apiTS:h,localID:encodeURIComponent(Aa),remoteID:encodeURIComponent(a),pcID:f,deviceID:Ca,sdpPayload:e};Ra.authToken&&c&&!Za?(i.token=Ra.authToken,ja(gb.sdpSubmission,i,g)):(i.clockUnsynced=Za,Pa.cacheEvent({channel:gb.sdpSubmission,data:i,callback:g}),Ra.authToken||Ra.sendAuthenticationRequest(za,Aa))},Tb=function(a,b,c,d,e,f,g){jc(a,function(a){b.localCandidates=a.localIceCandidates,b.remoteCandidates=a.remoteCandidates,b.iceCandidatePairs=a.iceCandidatePairs,b.activeIceCandidatePair=xc(b.iceCandidatePairs),g.currPair=b.activeIceCandidatePair,Rb(fb.fabricStateChange,e,c,d,g,f)})},Ub=function(a){var b={connectedDevices:pa},c=Wa[a]?Wa[a].ucID:null;Rb(fb.connectedDevices,null,a,c,b,null)},Vb=function(a){var b={ucID:Wa[a].ucID,endpoint:Va,magicKey:Mb};Rb(fb.refreshPresence,null,a,Wa[a].ucID,b,null)},Wb=function(){var a={appID:za,userID:encodeURIComponent(Aa),version:va,endpoint:Va,pagePerf:Ua,endpointID:Ca,action:"registerPresence",channel:gb.registerPresence};za!==-1&&Ra.authToken&&(a.token=Ra.authToken,$c(gb.registerPresence,a))},Xb=function(a,b){var c={};return c.status=a,b&&(c.message=b),c},Yb=function(a,b){var c,d,e,f=0;for(c=0,e=a.length;c<e;c++)d=a.charCodeAt(c),f=(f<<5)-f+d,f|=0;return b&&b(f),f},Zb=function(a,b,c,d,e,f){if(!a||!c||!b)return console.error("initialize: Argument missing/invalid"),Xb(hb.failure,"initialize: Argument missing/invalid");if(d&&"function"!=typeof d)return console.error("initialize: Argument missing/invalid"),Xb(hb.failure,"initialize: Argument missing/invalid");if(e&&"function"!=typeof e)return console.error("initialize: Argument missing/invalid"),Xb(hb.failure,"initialize: Argument missing/invalid");if("function"!=typeof b){if(!(window.crypto&&(window.crypto.subtle||window.crypto.webkitSubtle)||window.msCrypto&&window.msCrypto.subtle))return console.error("Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API"),d(ib.tokenGenerationError,"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API"),Xb(hb.failure,"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API");b=Ra.appSecretTokenGenerator(b)}if("string"==typeof a&&(a=parseInt(a,10)),za=a,"object"==typeof c?(Aa=c.aliasName,Ba=c):Aa=c,Ib(za,Aa,"log",{msg:"callstats initialize in progress"}),Ra.tokenGenerator=b,Db("csio_auth_data"))try{var g=JSON.parse(Db("csio_auth_data"));Ra._isTokenValid(g,za,Aa)&&(d&&d(ib.success,"SDK authentication successful."),Ra.setupAuthToken(g),Zc._isChannelReady()||Zc._setupWebSocketConnection(d))}catch(a){}return f&&(f.disableBeforeUnloadHandler===!0&&(Da=!0),null===f.applicationVersion&&void 0===f.applicationVersion||(Va.appVer=f.applicationVersion)),k(),ra=e,Ra.sendAuthenticationRequest(za,Aa,d),Xb(hb.success)},$b=function(a){return function(b){if(b.remoteUserID===a)return!0}},_b=function(a,b){var c=!1,d=null;return Wa[a]&&Wa[a].participants&&(d=Wa[a].participants.filter($b(b))),c=!!(d&&d.length>0)},ac=function(a){return function(b){return b.pc===a||(!(!a.callstatsID||b.pcHash!==a.callstatsID)||void 0)}},bc=function(a,b){var c=null,d=null;return Wa[a]&&Wa[a].participants&&(d=Wa[a].participants.filter(ac(b))),c=d&&d.length>0?d[0]:null},cc=function(a,b){var c=null,d=null;return c=bc(a,b),c&&(d=c.pcHash),d},dc=function(a){var b=null,c=null,d=null;for(b in Wa)if(Wa.hasOwnProperty(b)&&(d=bc(b,a))){c={fabric:d,conferenceID:b};break}return c},ec=function(a,b){var c=0;if(a&&Wa[b].participants)for(c=0;c<Wa[b].participants.length;c++)if(Wa[b].participants[c].pcHash===a.pcHash){Wa[b].participants.splice(c,1);break}},fc=function(a){var b=Ta.codebase,c=null,d=0;if(b===yb.firefox&&"Safari"!==Ta.name)c=[],a.forEach(function(a){c.push(a)});else if(b===yb.chrome&&"Safari"!==Ta.name)a&&a.result?c=a.result():a&&a.forEach&&(c=[],a.forEach(function(a){c.push(a)}));else{c=[];for(d in a)a.hasOwnProperty(d)&&c.push(a[d])}return c},gc=function(a){var b,c=null,d=null,e=null,f=[],g=[],h=[],i=0;if(c=fc(a),!c)return{localCandidates:f,remoteCandidates:g};for(i=0;i<c.length;++i)if(d=Y(c[i]),e=V(d),e.localCandidate)f.push(e.localCandidate);else if(e.remoteCandidate)g.push(e.remoteCandidate);else if(e.Transport){if("transport"===e.Transport.type){b=e.Transport.selectedCandidatePairId;continue}h.push(e.Transport)}else e.candidatePair&&h.push(e.candidatePair);if(b)for(i=0;i<h.length;i++)h[i].id===b&&(h[i].googActiveConnection="true");return{localCandidates:f,remoteCandidates:g,iceCandidatePairs:h}},hc=function(a){function b(b){var c={};c=gc(b),a(c)}return b},ic=function(a,b,c,d,e,f,g,h){var i=Ta.codebase,j=Ta.name;if(i===yb.firefox||"Safari"===j)a.getStats(null,c(b,d,e,f,g,h,a),function(a){Ib(za,d,"log",{msg:"### "+i+" getStats reports error "+JSON.stringify(a)})});else if(i===yb.chrome)try{a.getStats().then(c(b,d,e,f,g,h,a)).catch(function(i){a.getStats(c(b,d,e,f,g,h,a))})}catch(i){a.getStats(c(b,d,e,f,g,h,a))}else i===yb.edge&&a.getStats().then(c(b,d,e,f,g,h,a)).catch(function(a){Ib(za,d,"log",{msg:"### "+i+" getStats reports error "+JSON.stringify(a)})})},jc=function(a,b){ic(a,b,hc)},kc=function(a,b,d,e){if(!a||!b||!d)return console.error("sendFabricEvent: Arguments missing/Invalid"),Xb(hb.failure,"sendFabricEvent: Arguments missing/Invalid");if(!za||!Aa||!Wa[d])return console.error("sendFabricEvent: SDK is not initialized or no Fabrics added."),Xb(hb.failure,"sendFabricEvent: SDK is not initialized or no Fabrics added.");if(b===eb.fabricSetupFailed)return console.error("sendFabricEvent: Unsupported fabricEvent fabricSetupFailed"),Xb(hb.failure,"sendFabricEvent: Unsupported fabricEvent fabricSetupFailed");if(!o(a))return console.error("sendFabricEvent: Invalid PeerConnection object passed"),Xb(hb.failure,"sendFabricEvent: Invalid PeerConnection object passed");if(!eb.hasOwnProperty(b)&&!fb.hasOwnProperty(b))return console.error("sendFabricEvent: Invalid fabricEvents value: ",b),Xb(hb.failure,"sendFabricEvent: Invalid fabricEvents value: "+b);var f={},g=null,h=c(),i=Wa[d],j=null;if(void 0===i)return console.error("sendFabricEvent: Conference ID not found!"),Xb(hb.failure,"sendFabricEvent: Conference ID not found!");if(j=bc(d,a),null===j)return console.error("sendFabricEvent: fabricData is null"),Xb(hb.failure,"sendFabricEvent: fabricData is null");g=j.remoteUserID;var k=j.startTime;if(b===eb.fabricSetupFailed){var l=h-k;f={failureDelay:l,reason:sb.iceFailure,domError:Lb,fabricState:j.pcState,iceConnectionState:j.pc.iceConnectionState,function:rb.iceConnectionFailure,magicKey:Mb,endpoint:Va}}else if(b===eb.activeDeviceList){if(!e||!e.deviceList)return console.error("sendFabricEvent: Arguments missing/Invalid"),Xb(hb.failure,"sendFabricEvent: Arguments missing/Invalid");f={magicKey:Mb,endpoint:Va,activeDevicelist:e.deviceList}}if(Rb(b,g,d,i.ucID,f,j.pcHash,j.pcCallback),(b===eb.fabricTerminated||b===fb.autoFabricSetupFailed||b===eb.fabricSetupFailed)&&Wa[d].participants){j&&(j.statsInterval=ba(j.statsInterval),ec(j,d));var m=fa(d);m.conferenceFinished&&ga(d,m.ucID)}return Xb(hb.success)},lc=function(a){return a.length>Ia&&(console.log("Log exceeds 20kb, It will be truncated"),a=a.substring(0,Ia)),a},mc=function(a){return a&&"string"==typeof a?a=lc(a):a&&"object"==typeof a&&a.message&&(a.message=lc(a.message)),a},nc=function(a,b,c){return b?b:a&&a[c]?a[c].sdp:-1},oc=function(a,d,e,f,g,h){if(void 0===a||!e||!d)return console.error("reportError: Arguments missing/invalid"),Xb(hb.error,"reportError: Arguments missing/invalid");if(!za||!Aa)return console.error("reportError: SDK is not initialized"),Xb(hb.error,"reportError: SDK is not initialized");if(!rb.hasOwnProperty(e))return console.error("reportError: Invalid webRTC functionName value: %o",e),Xb(hb.error,"reportError: Invalid webRTC functionName value: "+e);void 0===f&&console.warn("reportError: Missing dom error parameter");var i,j=null,k=null,l=c(),m=Wa[d],n=null;if(i=U(e),f&&f instanceof DOMException)f={message:f.message,name:f.name};else if(f&&"object"==typeof f){var p={};f.message&&(p.message=f.message),f.name&&(p.name=f.name),f.constraintName&&(p.constraintName=f.constraintName),f.stack&&(p.stack=f.stack),f=p}if(f=mc(f),o(a)){if(void 0===m)return console.error("reportError: Conference ID not found!"),Xb(hb.error,"reportError: Conference ID not found!");if(n=bc(d,a),null===n)return console.error("reportError: Invalid pcObject passed as argument"),Xb(hb.error,"reportError: Invalid pcObject passed as argument");k=n.remoteUserID;var q=n.startTime,r=l-q;if(j={failureDelay:r,reason:i,domError:f,fabricState:n.pcState,iceConnectionState:n.pc.iceConnectionState,function:e,magicKey:Mb,endpoint:Va},e===rb.applicationLog||e===rb.applicationError?Rb(eb.applicationErrorLog,k,d,m.ucID,j,n.pcHash,n.pcCallback):Rb(eb.fabricSetupFailed,k,d,m.ucID,j,n.pcHash,n.pcCallback),g||h||a&&a.localDescription||a&&a.remoteDescription){var s={sdp:{}};s.sdp.localSDP=nc(a,g,"localDescription"),s.sdp.remoteSDP=nc(a,h,"remoteDescription"),Sb(k,d,m.ucID,s,n.pcHash)}}else{null===Mb&&(Mb=b());var t=null;e!==rb.getUserMedia&&(t=b()),j={failureDelay:0,reason:i,domError:f,function:e,magicKey:Mb,endpoint:Va},e===rb.applicationLog||e===rb.applicationError?Rb(eb.applicationErrorLog,k,d,null,j,null,null):Rb(eb.fabricSetupFailed,k,d,null,j,t,null)}return Xb(hb.success)},pc=function(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b[b.length]=d:d>127&&d<2048?(b[b.length]=d>>6|192,b[b.length]=63&d|128):(b[b.length]=d>>12|224,b[b.length]=d>>6&63|128,b[b.length]=63&d|128)}return new Uint8Array(b).buffer},qc=function(a){for(var b,c=new DataView(a),d="",e=0;e<c.byteLength;e++)b=c.getUint8(e).toString(16),b.length<2&&(b="0"+b),d+=b;return d},rc=function(a,b){var c={name:"SHA-256"};if(window.crypto){var d=window.crypto.subtle||window.crypto.webkitSubtle;if(!d)return void Yb(a,b);d.digest(c,pc(a)).then(function(a){b(qc(a))}).catch(function(){Yb(a,b)})}else if(window.msCrypto){if(!window.msCrypto.subtle)return void Yb(a,b);var e=window.msCrypto.subtle.digest(c,pc(a));e.oncomplete=function(a){a.target&&b(qc(a.target.result))},e.onerror=function(){Yb(a,b)}}else Yb(a,b)},sc=function(a,b,c){var d;if(!b||!a)return console.error("sendUserFeedback: Arguments missing/Invalid"),Xb(hb.error,"sendUserFeedback: Arguments missing/Invalid");if("object"!=typeof b)return console.error("sendUserFeedback: Invalid feedback object."),Xb(hb.error,"sendUserFeedback: Invalid feedback object.");if(0===Object.keys(b).length)return console.error("sendUserFeedback: Feedback data object must not be empty."),Xb(hb.error,"sendUserFeedback: Feedback data object must not be empty.");var e=Wa[a],f=null;void 0!==e&&void 0!==e.ucID&&(f=e.ucID);var g=null;if(g=null===Mb?$a:Mb,null===f&&(f=ia(a)),null===f)return console.error("sendUserFeedback: ucID unavailable"),Xb(hb.error,"sendUserFeedback: ucID unavailable");d="object"==typeof b.userID?b.userID.aliasName:b.userID,b&&b.overall<=0&&(b.overall=null);var h={conferenceID:encodeURIComponent(a),magicKey:g,appID:za,version:va,ucID:f,userID:encodeURIComponent(d),userQoe:{overall:b.overall}};return b.video&&(h.userQoe.video=b.video),b.audio&&(h.userQoe.audio=b.audio),b.screen&&(h.userQoe.screen=b.screen),b.comment&&(h.userQoe.comment=b.comment),Ra.authToken&&!Za?(h.token=Ra.authToken,Cb("feedback",JSON.stringify(h)),ja(gb.userFeedback,h,c)):(h.clockUnsynced=Za,Pa.cacheEvent({channel:gb.userFeedback,data:h,callback:c}),Ra.sendAuthenticationRequest(za,d)),Xb(hb.success)},tc=function(a,b,c,d,e,f){var g=null;if(g="object"==typeof b?b.aliasName:b,!(a&&c&&g&&d&&e))return console.error("associateMstWithUserID: Arguments missing"),Xb(hb.error,"associateMstWithUserID: Arguments missing");if(""===c||""===g||""===d||""===e)return console.error("associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty"),Xb(hb.error,"associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty");if(!o(a))return console.error("associateMstWithUserID: Invalid PeerConnection object passed"),Xb(hb.error,"associateMstWithUserID: Invalid PeerConnection object passed");var h=Wa[c];if(void 0===h)return console.error("associateMstWithUserID: conferenceID doesn't exist"),Xb(hb.error,"associateMstWithUserID: conferenceID doesn't exist");var i=null;if(i=bc(c,a),null===i)return console.error("associateMstWithUserID: Unknown pcObject passed"),Xb(hb.error,"associateMstWithUserID: Unknown pcObject passed");var j=Ob(i,d);return void 0===j&&(i.ssrcMap[d]={},j=Ob(i,d)),j.remoteUserID=g,j.ssrc=d,j.associatedVideoTag=f,j.usageLabel=e,f&&g!==Aa&&n(g,c,f,a,d),Xb(hb.success)},uc=function(a){return window&&!window.csioproxy?(console.error("setCallstatsURLs: cannot be called if window.csioproxy is false"),Xb(hb.error,"setCallstatsURLs: cannot be called if window.csioproxy is false")):a?(a.collectorURL&&(ta=a.collectorURL),a.authServiceURL&&(ua=a.authServiceURL),a.csioInternalAPIURL&&(ya=a.csioInternalAPIURL),a.wsURL&&(wa=a.wsURL),Na=!0,Vc(),Wc(),na(),Xb(hb.success)):(console.error("setCallstatsURLs: Arguments missing/Invalid"),Xb(hb.error,"setCallstatsURLs: Arguments missing/Invalid"))},vc=function(a,d,e,f,g){var h=null,i={authStatus:!!Ra.tokenData,clockSync:!Za,msg:"addNewFabric called",eventType:"warn",pageURL:window.location.href,conferenceID:f,version:va};if(Ib(za,Aa,"stateMachine",i),h="object"==typeof d?d.aliasName:d,!(a&&h&&e&&f))return console.error("addNewFabric: Arguments missing/Invalid"),Xb(hb.error,"addNewFabric: Arguments missing/Invalid");if(g&&"function"!=typeof g)return console.error("addNewFabric: Argument missing/invalid"),Xb(hb.failure,"addNewFabric: Argument missing/invalid");if(!za||!Aa)return console.error("addNewFabric: SDK not initialized."),Xb(hb.error,"addNewFabric: SDK not initialized");if(""===f||""===h)return console.error("addNewFabric: conferenceID or remoteUserID MUST not be empty"),Xb(hb.error,"addNewFabric: conferenceID or remoteUserID MUST not be empty");if(!o(a))return console.error("addNewFabric: Invalid PeerConnection object passed"),Xb(hb.error,"addNewFabric: Invalid PeerConnection object passed");if(!kb.hasOwnProperty(e)||e instanceof Function)return console.error("addNewFabric: Invalid fabricUsage value"),Xb(hb.error,"addNewFabric: Invalid fabricUsage value");var k=c();null===Mb&&(Mb=b());var l=null,m=!1;if(!da(f)){var n=$(Mb);Rb(fb.userJoined,null,f,null,n,null,null),m=!0,i={authStatus:!!Ra.tokenData,clockSync:!Za,msg:"userJoined sent",pageURL:window.location.href,eventType:"warn",conferenceID:f,version:va},Ib(za,Aa,"stateMachine",i)}if(_(f,l,m),!bc(f,a)){a&&a.addEventListener&&(a.addEventListener("icecandidate",Jc,!1),a.addEventListener("iceconnectionstatechange",Ic,!1),a.addEventListener("signalingstatechange",yc,!1),a.addEventListener("negotiationneeded",Hc,!1));var p=b(),q={pc:a,remoteUserID:h,fabricUsage:e,magicKey:Mb,startTime:k,pcCallback:g,pcState:qb.initializing,fabricSetupSent:!1,iceCandidates:[],iceConnectionState:a.iceConnectionState,latestEventSent:k,pcHash:p,localSDP:-1,remoteSDP:-1,statsInterval:null,initialPhaseOver:!1,intervalAdaptionPhase:!0,gatheringIceCandidatesDelay:0,connectivityIceStatusDelay:0,numNegotiationNeededCalls:0,currentActivePhaseIndex:0,ssrcMap:{}};"function"!=typeof a||a.callstatsID||(a.callstatsID=p),"connected"!==a.iceConnectionState&&"completed"!==a.iceConnectionState||(q.pcState=qb.established),ea(f,q),q.pcState===qb.established&&(Mc(a,fb.autoFabricSetup,f),zc(q,a,f,h))}return j(f),Xb(hb.success)},wc=function(a,b,c,d){if(!(a&&c&&d&&b))return console.error("reportUserIDChange: Arguments missing/Invalid"),Xb(hb.error,"reportUserIDChange: Arguments missing/Invalid");if(!za||!Aa)return console.error("reportUserIDChange: SDK not initialized."),Xb(hb.error,"reportUserIDChange: SDK not initialized");if(""===c||""===b)return console.error("reportUserIDChange: id or  conferenceID MUST not be empty"),Xb(hb.error,"reportUserIDChange: id or  conferenceID MUST not be empty");if(!o(a))return console.error("reportUserIDChange: Invalid PeerConnection object passed"),Xb(hb.error,"reportUserIDChange: Invalid PeerConnection object passed");var e,f=null,g=Wa[b];if(void 0===g)return console.error("reportUserIDChange: Conference ID not found!"),Xb(hb.error,"reportUserIDChange: Conference ID not found!");var h=null;if(void 0===g.ucID)return console.error("reportUserIDChange: addNewFabric was not called"),Ib(za,Aa,"log",{msg:"### reportUserIDChange: addNewFabric was not called"}),Xb(hb.error,"reportUserIDChange: addNewFabric was not called");if(h=g.ucID,f=bc(b,a),null===f)return console.error("reportUserIDChange: Invalid pcObject passed as argument"),Xb(hb.error,"reportUserIDChange: Invalid pcObject passed as argument");var i={id:c,idType:d};return Rb(eb.userIDChangedEvent,e,b,h,i,null,f.pcCallback),Xb(hb.success)},xc=function(a){var b=null;if(a&&a.length>0){var c=a.filter(function(a){return"true"===a.selected||"true"===a.googActiveConnection});c.length>0&&(b=c[0])}return b},yc=function(a){if(a){var b,c,d=Ta.codebase,e=null;if(d===yb.firefox)b=a.target;else if(d===yb.chrome)b=a.srcElement;else{if(d!==yb.edge)return void console.error("PeerConnection signaling state changed: unsupported code base");b=a.pc}if(void 0!==b){var f=b.signalingState;if(e=dc(b),e&&e.fabric){c=e.fabric.signalingState,e.fabric.signalingState=f;var g=e.conferenceID,h=e.fabric,i=h.remoteUserID,j=Wa[g].ucID,k={changedState:Ab.signalingState,prevState:c,newState:f};Tb(b,h,g,j,i,h.pcHash,k),"closed"===f&&kc(b,eb.fabricTerminated,e.conferenceID)}}}},zc=function(a,b,d,e){null===a.statsInterval&&(a.statsPollingStart=c(),Lc(b,d,e),a.statsInterval=setInterval(Lc,Xa.statsSubmissionIntervalInMS[a.currentActivePhaseIndex],b,d,e))},Ac=function(a,b,c,d,e,f){jc(a,function(a){b.localCandidates=a.localIceCandidates,b.remoteCandidates=a.remoteCandidates,b.iceCandidatePairs=a.iceCandidatePairs,b.activeIceCandidatePair=xc(b.iceCandidatePairs),f.localCandidates=b.localCandidates,Rb(fb.iceFailed,c,d,e,f,b.pcHash,b.pcCallback)})},Bc=function(a,b,c,d){var e=b.iceConnectionState,f=b.remoteUserID,g=Wa[c],h={prevIceConnectionState:e,currIceConnectionState:a.iceConnectionState,currPair:b.activeIceCandidatePair,failureDelay:d};b.pcState=qb.failed,"checking"===e?Ac(a,b,f,c,g.ucID,h):"completed"===e||"connected"===e?Rb(fb.fabricDropped,f,c,g.ucID,h,b.pcHash,b.pcCallback):"disconnected"===e&&b.established?Rb(fb.fabricDropped,f,c,g.ucID,h,b.pcHash,b.pcCallback):"disconnected"===e&&Ac(a,b,f,c,g.ucID,h)},Cc=function(a,b,d,e){var f=b.iceConnectionState,g=b.remoteUserID,h=Wa[d],i=c(),j={prevIceConnectionState:f,currIceConnectionState:a.iceConnectionState,prevPair:b.activeIceCandidatePair},k=b.pcState===qb.disrupted;b.connectivityIceStatusDelay=e,b.established=!0,jc(a,function(a){b.localCandidates=a.localIceCandidates,b.remoteCandidates=a.remoteCandidates,b.iceCandidatePairs=a.iceCandidatePairs,b.activeIceCandidatePair=xc(b.iceCandidatePairs),j.currPair=b.activeIceCandidatePair,j.disruptionDelay=i-b.disruptedTS,k&&Rb(fb.iceDisruptionEnd,g,d,h.ucID,j,b.pcHash,b.pcCallback)}),Mc(b.pc,fb.autoFabricSetup,d),b.pcState=qb.established,zc(b,a,d,g)},Dc=function(a,b,d){var e=b.iceConnectionState,f=b.remoteUserID,g=Wa[d],h=c(),i={prevIceConnectionState:e,currIceConnectionState:a.iceConnectionState,prevIceConnectionStateTs:b.iceConnectionStateTS,currPair:b.activeIceCandidatePair};b.startTime=h,"connected"===e||"completed"===e?(b.pcState=qb.disrupted,b.disruptedTS=h,Rb(fb.iceDisruptionStart,f,d,g.ucID,i,b.pcHash,b.pcCallback),b.pcCallback&&b.pcCallback(ib.appConnectivityError,"Connectivity check for PC object to "+f+" failed.")):"checking"===e&&(b.pcState=qb.checkingDisrupted,b.disruptedTS=h,Rb(fb.iceConnectionDisruptionStart,f,d,g.ucID,i,b.pcHash,b.pcCallback),b.pcCallback&&b.pcCallback(ib.appConnectivityError,"Connectivity check for PC object to "+f+" failed."))},Ec=function(a,b,c,d){var e=b.iceConnectionState,f=b.remoteUserID,g=Wa[c],h={prevIceConnectionState:e,currIceConnectionState:a.iceConnectionState};"new"===e||"checking"===e?(h.failureDelay=d,Rb(fb.iceAborted,f,c,g.ucID,h,b.pcHash,b.pcCallback)):(h.currPair=b.activeIceCandidatePair,Rb(fb.iceTerminated,f,c,g.ucID,h,b.pcHash,b.pcCallback))},Fc=function(a,b,c){var d=b.iceConnectionState,e=b.remoteUserID,f=Wa[c],g={prevIceConnectionState:d,currIceConnectionState:a.iceConnectionState,prevPair:b.activeIceCandidatePair};"new"!==d&&(b.established=!1,Rb(fb.iceRestarted,e,c,f.ucID,g,b.pcHash,b.pcCallback))},Gc=function(a,b,d,e){var f=b.iceConnectionState,g=b.remoteUserID,h=Wa[d],i=c(),j={prevIceConnectionState:f,currIceConnectionState:a.iceConnectionState};b.gatheringIceCandidatesDelay=e,"disconnected"===f&&b.pcState===qb.checkingDisrupted&&(j.disruptionDelay=i-b.disruptedTS,Rb(fb.iceConnectionDisruptionEnd,g,d,h.ucID,j,b.pcHash,b.pcCallback))},Hc=function(a){if(a){var b,c=Ta.codebase;if(c===yb.firefox)b=a.target;else if(c===yb.chrome)b=a.srcElement;else{if(c!==yb.edge)return void console.error("PeerConnection negotiation needed: unsupported code base");b=a.pc}if(void 0!==b){var d=null;d=dc(b),d&&d.fabric&&d.fabric.numNegotiationNeededCalls++}}},Ic=function(a){
if(a){var b,d=Ta.codebase;if(d===yb.firefox)b=a.target;else if(d===yb.chrome)b=a.srcElement;else{if(d!==yb.edge)return void console.error("PeerConnection ICE connection state changed: unsupported code base");b=a.pc}if(void 0!==b){var e,f,g,h,i,j=null,k=null;if(k=dc(b),k&&k.fabric){j=k.fabric,e=k.conferenceID,f=c(),g=f-j.startTime,h=j.iceConnectionState,i=j.iceGatheringState;var l=j.remoteUserID,m=Wa[e].ucID,n={changedState:Ab.iceConnectionState,prevState:h,newState:b.iceConnectionState};Tb(b,j,e,m,l,j.pcHash,n),i!==b.iceGatheringState&&(n.changedState=Ab.iceGatheringState,n.prevState=i,n.newState=b.iceGatheringState,Tb(b,j,e,m,l,j.pcHash,n)),"complete"===b.iceGatheringState&&"checking"===b.iceConnectionState&&Gc(b,j,e,g),"connected"===b.iceConnectionState||"completed"===b.iceConnectionState?Cc(b,j,e,g):"failed"===b.iceConnectionState?Bc(b,j,e,g):"disconnected"===b.iceConnectionState?Dc(b,j,e):"closed"===b.iceConnectionState?Ec(b,j,e,g):"new"===b.iceConnectionState&&Fc(),j.iceConnectionState=b.iceConnectionState,j.iceGatheringState=b.iceGatheringState,j.iceConnectionStateTS=c()}}}},Jc=function(a){var b,c,d;if(null!==a.candidate){var e=a.candidate.candidate;c=e.split(" ");var f="1"===c[1]?"rtp":"rtcp";"0"!==c[5]&&(d=c[4].indexOf(":")!==-1,b={transport:c[2],protocol:f,typePreference:c[3],address:d?"["+c[4]+"]:"+c[5]:c[4]+":"+c[5],type:c[7],media:a.candidate.sdpMid})}var g,h=Ta.codebase;if(h===yb.firefox)g=a.target;else if(h===yb.chrome)g=a.srcElement;else{if(h!==yb.edge)return void console.error("PeerConnection ICE candidate found: unsupported code base");g=a.pc}if(void 0!==g){var i=null;i=dc(g),i&&i.fabric&&void 0!==b&&i.fabric.iceCandidates.indexOf(b)===-1&&i.fabric.iceCandidates.push(b)}},Kc=function(a){var b,c=5e3;return Ea?(b=Fa,a.intervalAdaptionPhase=!1,Ea=!1):a.currentActivePhaseIndex<Xa.statsSubmissionIntervalInMS.length-1?(a.currentActivePhaseIndex+=1,b=Xa.statsSubmissionIntervalInMS[a.currentActivePhaseIndex],b>Ja&&(b=Ja,a.intervalAdaptionPhase=!1,a.initialPhaseOver=!0)):(b=Ja,a.intervalAdaptionPhase=!1),b>c&&(a.initialPhaseOver=!0),b},Lc=function(a,b,d){if(!Wa.hasOwnProperty(b))return void console.error("ConferenceID %o doesn't exist. Can't call getStats for it.",b);if(!_b(b,d))return void console.error("Remote user ID %o doesn't exist. Can't call getStats for it.",d);if("closed"===a.signalingState)return kc(a,eb.fabricTerminated,b),!0;var e=bc(b,a);if(e.pcState!==qb.established&&e.lastFabricState===e.pcState&&"connected"!==a.iceConnectionState&&"completed"!==a.iceConnectionState)return!0;var f=Wa[b].ucID;ic(a,e.pcCallback,T,Aa,d,b,f,e);var g,h=c(),i=h-e.statsPollingStart;(i>Xa.statsSubmissionPhaseDurationInMS[e.currentActivePhaseIndex]&&e.intervalAdaptionPhase||Ea===!0)&&(ba(e.statsInterval),g=Kc(e),e.statsInterval=setInterval(Lc,g,a,b,d))},Mc=function(a,b,d){var e,f=null,g=Wa[d],h=null,i=c();if(void 0===g&&console.error("sendAutoFabricSetupEvent: Conference ID not found!"),h=bc(d,a),null===h&&console.error("sendAutoFabricSetupEvent: fabricData is null"),!h.fabricSetupSent){f=h.remoteUserID,e=i-h.startTime;var j={setupDelay:e,iceGatheringDelay:h.gatheringIceCandidatesDelay,iceConnectivityDelay:h.connectivityIceStatusDelay};Za||(j.clockSyncOffset=Ya.currentOffset),jc(a,function(a){j.localCandidates=a.localCandidates,j.remoteCandidates=a.remoteCandidates,j.iceCandidatePairs=a.iceCandidatePairs,h.localCandidates=a.localCandidates,h.remoteCandidates=a.remoteCandidates,h.iceCandidatePairs=a.iceCandidatePairs,h.pcState=qb.established,h.fabricSetupSent=!0,h.activeIceCandidatePair=xc(h.iceCandidatePairs),Rb(b,f,d,g.ucID,j,h.pcHash,h.pcCallback)})}},Nc=function(a,b,c){var d={},e=null,f=Wa[c],g=null;void 0===f&&console.error("sendFabricTransportSwitchEvent: Conference ID not found!"),g=bc(c,a),null===g&&console.error("sendFabricTransportSwitchEvent: fabricData is null"),e=g.remoteUserID,d.prevPair=g.activeIceCandidatePair,jc(a,function(a){d.currPair=xc(a.iceCandidatePairs),g.activeIceCandidatePair=d.currPair,d.switchDelay=null,d.relayType=g.transportData.relayType,Rb(b,e,c,f.ucID,d,g.pcHash,g.pcCallback)})},Oc=function(a,b){if(a.trackStats){var c=a.trackStats.filter(function(a){return a.id===b});if(c.length>0)return c[0]}},Pc=function(a,b){if(a.codec){var c=a.codec.filter(function(a){return a.id===b});if(c.length>0)return c[0]}},Qc=function(a,b){if(a.candidatePair){var c=a.candidatePair.filter(function(a){return a.id===b});if(c.length>0)return c[0]}},Rc=function(a){for(var b,c,d=a.Transport.length,e=0;e<d;e++)c=a.Transport[e],c.selectedCandidatePairId&&(b=Qc(a,c.selectedCandidatePairId),b&&(a.Transport[e]=S(a.Transport[e],b)));return a},Sc=function(a){for(var b,c,d,e=a.streams.length,f=0;f<e;f++)b=a.streams[f],b.data.trackId&&(c=Oc(a,b.data.trackId),c&&(a.streams[f].data=S(a.streams[f].data,c))),b.data.codecId&&(d=Pc(a,b.data.codecId),d&&(a.streams[f].data=S(a.streams[f].data,d)));return a},Tc=function(a,b,c){b.hasOwnProperty(a)&&(b[a].hasOwnProperty("video")&&(b[a].video.isGreaterBetter?(c.video.gThreshold=b[a].video.upperThreshold,c.video.rThreshold=b[a].video.lowerThreshold):(c.video.gThreshold=b[a].video.lowerThreshold,c.video.rThreshold=b[a].video.upperThreshold)),b[a].hasOwnProperty("audio")&&(b[a].audio.isGreaterBetter?(c.audio.gThreshold=b[a].audio.upperThreshold,c.audio.rThreshold=b[a].audio.lowerThreshold):(c.audio.gThreshold=b[a].audio.lowerThreshold,c.audio.rThreshold=b[a].audio.upperThreshold)))},Uc=function(a,b,c){var d=[];for(var e in b)b.hasOwnProperty(e)&&d.push(encodeURIComponent(e)+"="+encodeURIComponent(b[e]));var f=d.join("&"),g=new XMLHttpRequest;g.open("POST",a),g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),g.onload=function(){c(g)},g.send(f)},Vc=function(){Gb(ya,function(a){if(200===a.status)try{var b=JSON.parse(a.responseText);Tc("eModelThreshold",b,xb),Tc("throughputThreshold",b,tb),Tc("fractionalLossThreshold",b,wb),Tc("rttThreshold",b,vb),Tc("currOverPrevFrameRateThreshold",b,ub)}catch(a){return a}})},Wc=function(){var a=ta+"clockSync",b=null,d=null;Gb(a,function(a,e){200===a.status?(b=JSON.parse(a.response),d=c(),Xc(b,e,d)):Za&&setTimeout(function(){Wc()},100)})},Xc=function(a,b,c){if(Za){var d=b/2;if(d>Ya.maxAllowedLatency)Ya.offsetResults=[],Ib(za,Aa,"log",{msg:"clockSync restarting"});else{var e=a.now+d,f=e-c;Ya.offsetResults.push(f)}if(Ya.offsetResults.length>=Ya.syncAttempts){var g=Ya.offsetResults.reduce(function(a,b){return a+b});Ya.currentOffset=g/Ya.offsetResults.length,Ya.offsetResults=[],Za=!1,Ib(za,Aa,"log",{msg:"clockSync Done"}),Pa.sendCachedUserJoinedEvents(Ra),Pa.sendCachedEvents(Ra,Za)}else Za&&setTimeout(function(){Wc()},100)}},Yc=function(){var a=this,b=null,d=!1,e=!1,f={},g={initiated:"initiated",connected:"connected",closed:"closed"};this._wsConnectionState=g.closed;var h=function(a,b){try{if(window&&window.sessionStorage){var c=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));c||(c={}),c[a]||(c[a]={}),c[a].ucID=b,window.sessionStorage.setItem("csio_ucid_data",JSON.stringify(c))}}catch(a){return}f[a]=xa+za+"/conferences/"+encodeURIComponent(a)+"/"+b+"/general"};this.getConferenceURL=function(){return f},this._setupWebSocketConnection=function(f){return a._wsConnectionState===g.initiated||a._wsConnectionState===g.connected?(Ib(za,Aa,"log",{msg:"### _setupWebSocketConnection is called when already connected!"}),void(f&&f(ib.success,"WebSocket establishment successful."))):(a._wsConnectionState=g.initiated,b=new WebSocket(wa,"echo-protocol"),b.onopen=function(){Ib(za,Aa,"log",{msg:"Successfully connected to the backend"}),a._wsConnectionState=g.connected,d?e=!0:d=!0,Ya.syncHandler||(Ib(za,Aa,"log",{msg:"start clockSync"}),Ya.offsetResults=[],Wc(),Ya.syncHandler=!0),Pa.sendCachedUserJoinedEvents(Ra),e?(ha(),Pa.sendCachedEvents(Ra)):Wb(),e=!1},b.onclose=function(){a._wsConnectionState=g.closed,Ib(za,Aa,"log",{msg:"Connection to the server closed."}),ca(),Za&&(Ya.offsetResults=[],Ya.syncHandler=null,Za=!1),b&&(b=null),f&&f(ib.httpError,"Connection to the server closed.")},b.onerror=function(b){a._wsConnectionState=g.closed,Ib(za,Aa,"log",{msg:"WebSocket establishment failed."}),f&&f(ib.wsChannelFailure,"WebSocket establishment failed.",b)},void(b.onmessage=function(a){var b,d=a.data,e=c(),g=JSON.parse(d);if("Error"===g.status)"Invalid client token."===g.reason&&(Ra.tokenData=null,Ra.authToken=null,Ra.sendAuthenticationRequest(za,Aa)),f&&f(ib.csProtoError,d.reason);else if("200 OK"===g.status)if("feedback"===g.event)Eb("feedback");else if(g.event===fb.userJoined||g.event===fb.refreshPresence){var i=!1,j=null;b=decodeURIComponent(g.conferenceID);var k=function(a){return setInterval(function(){Vb(a)},La)};Wa.hasOwnProperty(b)&&(Wa[b].ucID!==g.ucID&&(i=!0,h(b,g.ucID),j=g.conferenceCreationTS?g.conferenceCreationTS:g.conferenceDuration),g.event!==fb.userJoined||Wa[b].refreshPresence||(Wa[b].refreshPresence=k(b),oa()),Wa[b].ucID=g.ucID),Pa.sendCachedFeedback(),Pa.sendCachedEvents(Ra,Za,i,j,b,g.ucID)}else g.event===gb.clockSync?Xc(g,e):g.event===eb.fabricSetupFailed&&(b=decodeURIComponent(g.conferenceID),g.ucID&&(h(b,g.ucID),Pa.sendCachedFeedback(),Pa.sendCachedEvents(Ra,Za,!0,0,b,g.ucID)))}))},this._isChannelReady=function(){return!(!b||1!==b.readyState)},this.getWSConnectionState=function(){return b?b.readyState:-1},this.send=function(a){b.send(JSON.stringify(a))}},Zc=new Yc,$c=function(a,b,c){if(Zc._isChannelReady())try{Zc.send(b)}catch(d){d&&"InvalidStateError"===d.name&&Pa.cacheEvent({channel:a,data:b,callback:c})}else Pa.cacheEvent({channel:a,data:b,callback:c}),Zc._setupWebSocketConnection()};return f(),Fb(),window&&!window.csioproxy&&(Na=!0,Vc(),Wc(),na()),{version:va,initialize:Zb,fabricEvent:eb,addNewFabric:vc,sendFabricEvent:kc,sendUserFeedback:sc,associateMstWithUserID:tc,csError:ib,fabricUsage:kb,qualityRating:mb,webRTCFunctions:rb,reportError:oc,reportUserIDChange:wc,userIDType:lb,setProxyConfig:uc,callStatsAPIReturnStatus:hb}}"function"==typeof define&&define.amd?define("callstats",[],c):b.callstats=c}("undefined"!=typeof window?window:"undefined"!=typeof b?b:this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./callstatsUtils":2}],2:[function(a,b,c){"use strict";function d(){}d.prototype.measureAppLoadingPerformance=function(a){var b=0,c=Number.MAX_VALUE,d=0,e="",f="",g=window.performance;if(!("performance"in window&&"timing"in window.performance&&"navigation"in window.performance))return{support:"none",total:void 0};var h=g.timing.loadEventEnd-g.timing.navigationStart;if("Chrome"===a.name||"Opera"===a.name){var i,j=g.getEntriesByType("resource");for(i=0;i<j.length;i++)j[i].duration>d&&(f=j[i].name.substr(j[i].name.lastIndexOf("/")+1),d=j[i].duration),j[i].duration<c&&(e=j[i].name.substr(j[i].name.lastIndexOf("/")+1),c=j[i].duration),j[i].name.indexOf("CALLSTATS_SRC_URLstatic/callstats")>-1&&(b=j[i].duration);return{support:"full",callstats:b,min:{name:e,time:c},max:{name:f,time:d},total:h}}return"Firefox"===a.name?{support:"limited",total:h}:void 0},d.prototype.detectBrowserInfo=function(){var a,b,c=navigator.userAgent,d=c.toLowerCase(),e="Chrome",f=navigator.appVersion,g=""+parseFloat(navigator.appVersion),h={goog:"Chrome",moz:"Firefox",plugin:"Plugin",edge:"Edge"};(a=d.indexOf("opera"))!==-1?(e="Opera",g=d.substring(a+6),(a=d.indexOf("Version"))!==-1&&(g=d.substring(a+8)),b=h.goog):(a=d.indexOf("opr"))!==-1?(e="Opera",g=d.substring(a+4),(a=d.indexOf("Version"))!==-1&&(g=d.substring(a+8)),b=h.goog):(a=d.indexOf("msie"))!==-1?(e="Microsoft Internet Explorer",g=d.substring(a+5),b=h.goog):(a=d.indexOf("edge"))!==-1?(e=h.edge,g=d.substring(a+5),b=h.edge):(a=d.indexOf("chrome"))!==-1?(e=h.goog,g=d.substring(a+7),b=h.goog):(a=d.indexOf("safari"))!==-1?(e="Safari",g=d.substring(a+7),(a=d.indexOf("Version"))!==-1&&(g=d.substring(a+8)),b=h.goog):(a=d.indexOf("firefox"))!==-1?(e="Firefox",g=d.substring(a+8),b=h.moz):(a=d.indexOf("trident"))!==-1&&(e="Microsoft Internet Explorer",a=d.indexOf("rv"),g=d.substring(a+3,a+7),b=h.goog);var i,j,k=null,l=[{s:"Windows 3.11",r:/win16/},{s:"Windows 95",r:/(windows 95|win95|windows_95)/},{s:"Windows ME",r:/(win 9x 4.90|windows me)/},{s:"Windows 98",r:/(windows 98|win98)/},{s:"Windows CE",r:/windows ce/},{s:"Windows 2000",r:/(windows nt 5.0|windows 2000)/},{s:"Windows XP",r:/(windows nt 5.1|windows xp)/},{s:"Windows Server 2003",r:/windows nt 5.2/},{s:"Windows Vista",r:/windows nt 6.0/},{s:"Windows 7",r:/(windows 7|windows nt 6.1)/},{s:"Windows 8.1",r:/(windows 8.1|windows nt 6.3)/},{s:"Windows 8",r:/(windows 8|windows nt 6.2)/},{s:"Windows 10",r:/(windows 10|windows nt 10.0)/},{s:"Windows NT 4.0",r:/(windows nt 4.0|winnt4.0|winnt|windows nt)/},{s:"Windows ME",r:/windows me/},{s:"Android",r:/android/},{s:"Open BSD",r:/openbsd/},{s:"Sun OS",r:/sunos/},{s:"Linux",r:/(linux|x11)/},{s:"iOS",r:/(iphone|ipad|ipod)/},{s:"Mac OS X",r:/mac os x/},{s:"Mac OS",r:/(macppc|macintel|mac_powerpc|macintosh)/},{s:"QNX",r:/qnx/},{s:"UNIX",r:/unix/},{s:"BeOS",r:/beos/},{s:"OS/2",r:/os\/2/},{s:"Search Bot",r:/(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/}];for(i in l)if(j=l[i],j.r.test(d)){k=j.s;break}var m=null;switch(k&&/Windows/.test(k)&&(m=/Windows (.*)/.exec(k)[1],k="Windows"),k){case"Mac OS X":m=/mac os x (10[\.\_\d]+)/.exec(d)[1];break;case"Android":m=/android ([\.\_\d]+)/.exec(d)[1];break;case"iOS":m=/os (\d+)_(\d+)_?(\d+)?/.exec(f),m=m[1]+"."+m[2]+"."+(0|m[3])}return{name:e,ver:g.toString(),os:k,osVersion:m,codebase:b,userAgent:c}},b.exports=d},{}]},{},[1]);